/*!
2014/8/12
 */
//if (typeof console== "undefined"){var console={"log":function(a){},"clear":function(){},"error":function(){}};}
var ws=null;
function GUID() {
	this.date = new Date();
	/* 判断是否初始化过，如果初始化过以下代码，则以下代码将不再执行，实际中只执行一次 */
	if (typeof this.newGUID != 'function') {
		/* 生成GUID码 */
		GUID.prototype.newGUID = function() {
			this.date = new Date();
			var guidStr = '';
			sexadecimalDate = this.hexadecimal(this.getGUIDDate(), 16);
			sexadecimalTime = this.hexadecimal(this.getGUIDTime(), 16);
			for (var i = 0; i < 9; i++) {
				guidStr += Math.floor(Math.random()*16).toString(16);
			}
			guidStr += sexadecimalDate;
			guidStr += sexadecimalTime;
			while(guidStr.length < 32) {
				guidStr += Math.floor(Math.random()*16).toString(16);
			}
			return this.formatGUID(guidStr);
		}
		/*
		* 功能：获取当前日期的GUID格式，即8位数的日期：19700101
		* 返回值：返回GUID日期格式的字条串
		*/
		GUID.prototype.getGUIDDate = function() {
			return this.date.getFullYear() + this.addZero(this.date.getMonth() + 1) + this.addZero(this.date.getDay());
		}

		/*
		* 功能：获取当前时间的GUID格式，即8位数的时间，包括毫秒，毫秒为2位数：12300933
		* 返回值：返回GUID日期格式的字条串
		*/
		GUID.prototype.getGUIDTime = function() {
			return this.addZero(this.date.getHours()) + this.addZero(this.date.getMinutes()) + this.addZero(this.date.getSeconds()) + this.addZero( parseInt(this.date.getMilliseconds() / 10 ));
		}

		/*
		* 功能: 为一位数的正整数前面添加0，如果是可以转成非NaN数字的字符串也可以实现
		* 参数: 参数表示准备再前面添加0的数字或可以转换成数字的字符串
		* 返回值: 如果符合条件，返回添加0后的字条串类型，否则返回自身的字符串
		*/
		GUID.prototype.addZero = function(num) {
			if (Number(num).toString() != 'NaN' && num >= 0 && num < 10) {
				return '0' + Math.floor(num);
			} else {
				return num.toString();
			}
		}

		/* 
		* 功能：将y进制的数值，转换为x进制的数值
		* 参数：第1个参数表示欲转换的数值；第2个参数表示欲转换的进制；第3个参数可选，表示当前的进制数，如不写则为10
		* 返回值：返回转换后的字符串
		*/
		GUID.prototype.hexadecimal = function(num, x, y) {
			if (y != undefined) {
				return parseInt(num.toString(), y).toString(x);
			} else {
				return parseInt(num.toString()).toString(x);
			}
		}

		/*
		* 功能：格式化32位的字符串为GUID模式的字符串
		* 参数：第1个参数表示32位的字符串
		* 返回值：标准GUID格式的字符串
		*/
		GUID.prototype.formatGUID = function(guidStr) {
			var str1 = guidStr.slice(0, 8) + '-',
			str2 = guidStr.slice(8, 12) + '-',
			str3 = guidStr.slice(12, 16) + '-',
			str4 = guidStr.slice(16, 20) + '-',
			str5 = guidStr.slice(20);
			return str1 + str2 + str3 + str4 + str5;
		}
	}
}
var guid=new GUID;(function(f,q,N){function V(a){return"[object Function]"===ia.call(a)}function W(a){return"[object Array]"===ia.call(a)}function da(a){return a&&"[object Object]"===ia.call(a)}function ba(a){return(a||"").replace(/^\s+|\s+$/g,"")}function ca(a,e){var c=!1;if(da(e)){a=a||{};for(var d in e){var h=e[d];a[d]!=h&&(c=c||{},c[d]=h)}}return c}function Q(a){var e=[];if(null!=a){var c=a.length;if(null==c||"string"===typeof a||V(a)||a.setInterval)e[0]=a;else for(;c;)e[--c]=a[c]}return e}function x(){var a=arguments[0]||{},e=1,c=arguments.length,d=!1,h;"boolean"===typeof a&&(d=a,a=arguments[1]||{},e=2);for("object"===typeof a||V(a)||(a={});e<c;e++)if(null!=(h=arguments[e]))for(var w in h){var f=a[w],k=h[w];a!==k&&(d&&k&&"object"===typeof k&&!k.nodeType?a[w]=x(d,f||(null!=k.length?[]:{}),k):k!==N&&(a[w]=k))}return a}function F(a,e,c){var d,h=0,w=a.length,f=w===N||V(a);if(c)if(f)for(d in a){if(!1===e.apply(a[d],c))break}else for(;h<w&&!1!==e.apply(a[h++],c););else if(f)for(d in a){if(!1===e.call(a[d],d,a[d]))break}else for(c=a[0];h<w&&!1!==e.call(c,h,c);c=a[++h]);return a}function O(a,e,c){for(var d=[],h=0,w=a.length;h<w;h++)!c!==!e(a[h],h)&&d.push(a[h]);return d}function X(a,e){for(var c=[],d,h=0,w=a.length;h<w;h++)d=e(a[h],h),null!=d&&(c[c.length]=d);return c.concat.apply([],c)}function P(a){this.type=a;this.timeStamp=(new Date).getTime()}function y(a){this.URL=a;this._setting();this._connect()}function m(a,e){var c=this;ws=c.ws=new WebSocket(a);ws.onopen=function(a){c.trigger("open","success");"zend"in _IMC.user&&(a={type:"login",Customer_zend:_IMC.user.zend||"",Customer_rnd:_IMC.user.rnd||"",Customer_type:_IMC.user.type||"0",Customer_uid:_IMC.user.id||0,Customer_show:webimUI.im.status.get("s")||"available"},a=T.stringify(a),ws.send(a))};ws.onclose=function(a){c.trigger("close",[a.data]);f.clearTimeout(aa);aa=f.setTimeout(function(){webimUI.im.online()},6E4)};ws.onmessage=function(a){ea("line 1220 \u63a5\u6536socket\u4fe1\u606f",a.data);a=a.data;try{a=a?f.JSON&&f.JSON.parse?f.JSON.parse(a):(new Function("return "+a))():a}catch(h){}c.trigger("message",[a])};ws.onerror=function(a){c.trigger("error",[])}}function fa(a,e,c){if("undefined"!=typeof e){c=c||{};null===e&&(e="",c.expires=-1);var d="";c.expires&&("number"==typeof c.expires||c.expires.toUTCString)&&("number"==typeof c.expires?(d=new Date,d.setTime(d.getTime()+864E5*c.expires)):d=c.expires,d="; expires\x3d"+d.toUTCString());var h=c.path?"; path\x3d"+c.path:"",w=c.domain?"; domain\x3d"+c.domain:"";c=c.secure?"; secure":"";q.cookie=[a,"\x3d",encodeURIComponent(e),d,h,w,c].join("")}else{e=null;if(q.cookie&&""!=q.cookie)for(c=q.cookie.split(";"),d=0;d<c.length;d++)if(h=ba(c[d]),h.substring(0,a.length+1)==a+"\x3d"){e=decodeURIComponent(h.substring(a.length+1));break}return e}}function ea(){var a=new Date;["[",a.getHours(),":",a.getMinutes(),":",a.getSeconds(),"-",a.getMilliseconds(),"]"].join("");f&&f.console&&f.console.log&&"function"==typeof f.console.log?f.console.log.apply(console,arguments):f&&f.runtime&&f.air&&f.air.Introspector&&f.air.Introspector.Console&&f.air.Introspector.Console.log&&f.air.Introspector.Console.log.apply(null,arguments)}function k(a,e){this.options=x({},k.defaults,e);this._init(a,e)}function ga(a){return a&&a.split?a.split(","):W(a)?a:parseInt(a)?[parseInt(a)]:[]}function G(a,e,c){function d(a,c){this.data=a;this.options=x({},d.defaults,c);V(this._init)&&this._init()}d.defaults=e;P.on(d);x(d.prototype,c);k[a]=d}function M(a,e){if("string"==typeof a&&(a[a]=e,e===N))return M[a];x(M,a)}var Y=Y||function(a,e){var c={},d=c.lib={},h=function(){},w=d.Base={extend:function(a){h.prototype=this;var d=new h;a&&d.mixIn(a);d.hasOwnProperty("init")||(d.init=function(){d.$super.init.apply(this,arguments)});d.init.prototype=d;d.$super=this;return d},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var d in a)a.hasOwnProperty(d)&&(this[d]=a[d]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},f=d.WordArray=w.extend({init:function(a,d){a=this.words=a||[];this.sigBytes=d!=e?d:4*a.length},toString:function(a){return(a||q).stringify(this)},concat:function(a){var d=this.words,c=a.words,g=this.sigBytes;a=a.sigBytes;this.clamp();if(g%4)for(var e=0;e<a;e++)d[g+e>>>2]|=(c[e>>>2]>>>24-e%4*8&255)<<24-(g+e)%4*8;else if(65535<c.length)for(e=0;e<a;e+=4)d[g+e>>>2]=c[e>>>2];else d.push.apply(d,c);this.sigBytes+=a;return this},clamp:function(){var d=this.words,c=this.sigBytes;d[c>>>2]&=4294967295<<32-c%4*8;d.length=a.ceil(c/4)},clone:function(){var a=w.clone.call(this);a.words=this.words.slice(0);return a},random:function(d){for(var c=[],e=0;e<d;e+=4)c.push(4294967296*a.random()|0);return new f.init(c,d)}}),k=c.enc={},q=k.Hex={stringify:function(a){var d=a.words;a=a.sigBytes;for(var c=[],g=0;g<a;g++){var e=d[g>>>2]>>>24-g%4*8&255;c.push((e>>>4).toString(16));c.push((e&15).toString(16))}return c.join("")},parse:function(a){for(var d=a.length,c=[],g=0;g<d;g+=2)c[g>>>3]|=parseInt(a.substr(g,2),16)<<24-g%8*4;return new f.init(c,d/2)}},r=k.Latin1={stringify:function(a){var d=a.words;a=a.sigBytes;for(var c=[],g=0;g<a;g++)c.push(String.fromCharCode(d[g>>>2]>>>24-g%4*8&255));return c.join("")},parse:function(a){for(var d=a.length,c=[],g=0;g<d;g++)c[g>>>2]|=(a.charCodeAt(g)&255)<<24-g%4*8;return new f.init(c,d)}},m=k.Utf8={stringify:function(a){try{return decodeURIComponent(escape(r.stringify(a)))}catch(H){throw Error("Malformed UTF-8 data");}},parse:function(a){return r.parse(unescape(encodeURIComponent(a)))}},I=d.BufferedBlockAlgorithm=w.extend({reset:function(){this._data=new f.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=m.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(d){var c=this._data,e=c.words,g=c.sigBytes,h=this.blockSize,w=g/(4*h),w=d?a.ceil(w):a.max((w|0)-this._minBufferSize,0);d=w*h;g=a.min(4*d,g);if(d){for(var r=0;r<d;r+=h)this._doProcessBlock(e,r);r=e.splice(0,d);c.sigBytes-=g}return new f.init(r,g)},clone:function(){var a=w.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});d.Hasher=I.extend({cfg:w.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){I.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(d,c){return(new a.init(c)).finalize(d)}},_createHmacHelper:function(a){return function(d,c){return(new U.HMAC.init(a,c)).finalize(d)}}});var U=c.algo={};return c}(Math);(function(a){function e(a,d,c,e,h,g,f){a=a+(d&c|~d&e)+h+f;return(a<<g|a>>>32-g)+d}function c(a,d,c,e,h,g,f){a=a+(d&e|c&~e)+h+f;return(a<<g|a>>>32-g)+d}function d(a,d,c,e,h,g,f){a=a+(d^c^e)+h+f;return(a<<g|a>>>32-g)+d}function h(a,d,c,e,h,g,f){a=a+(c^(d|~e))+h+f;return(a<<g|a>>>32-g)+d}for(var w=Y,f=w.lib,k=f.WordArray,q=f.Hasher,f=w.algo,r=[],m=0;64>m;m++)r[m]=4294967296*a.abs(a.sin(m+1))|0;f=f.MD5=q.extend({_doReset:function(){this._hash=new k.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,f){for(var w=0;16>w;w++){var k=f+w,B=a[k];a[k]=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360}var w=this._hash.words,k=a[f+0],B=a[f+1],g=a[f+2],C=a[f+3],q=a[f+4],D=a[f+5],m=a[f+6],A=a[f+7],J=a[f+8],x=a[f+9],y=a[f+10],I=a[f+11],K=a[f+12],F=a[f+13],U=a[f+14],E=a[f+15],u=w[0],v=w[1],t=w[2],p=w[3],u=e(u,v,t,p,k,7,r[0]),p=e(p,u,v,t,B,12,r[1]),t=e(t,p,u,v,g,17,r[2]),v=e(v,t,p,u,C,22,r[3]),u=e(u,v,t,p,q,7,r[4]),p=e(p,u,v,t,D,12,r[5]),t=e(t,p,u,v,m,17,r[6]),v=e(v,t,p,u,A,22,r[7]),u=e(u,v,t,p,J,7,r[8]),p=e(p,u,v,t,x,12,r[9]),t=e(t,p,u,v,y,17,r[10]),v=e(v,t,p,u,I,22,r[11]),u=e(u,v,t,p,K,7,r[12]),p=e(p,u,v,t,F,12,r[13]),t=e(t,p,u,v,U,17,r[14]),v=e(v,t,p,u,E,22,r[15]),u=c(u,v,t,p,B,5,r[16]),p=c(p,u,v,t,m,9,r[17]),t=c(t,p,u,v,I,14,r[18]),v=c(v,t,p,u,k,20,r[19]),u=c(u,v,t,p,D,5,r[20]),p=c(p,u,v,t,y,9,r[21]),t=c(t,p,u,v,E,14,r[22]),v=c(v,t,p,u,q,20,r[23]),u=c(u,v,t,p,x,5,r[24]),p=c(p,u,v,t,U,9,r[25]),t=c(t,p,u,v,C,14,r[26]),v=c(v,t,p,u,J,20,r[27]),u=c(u,v,t,p,F,5,r[28]),p=c(p,u,v,t,g,9,r[29]),t=c(t,p,u,v,A,14,r[30]),v=c(v,t,p,u,K,20,r[31]),u=d(u,v,t,p,D,4,r[32]),p=d(p,u,v,t,J,11,r[33]),t=d(t,p,u,v,I,16,r[34]),v=d(v,t,p,u,U,23,r[35]),u=d(u,v,t,p,B,4,r[36]),p=d(p,u,v,t,q,11,r[37]),t=d(t,p,u,v,A,16,r[38]),v=d(v,t,p,u,y,23,r[39]),u=d(u,v,t,p,F,4,r[40]),p=d(p,u,v,t,k,11,r[41]),t=d(t,p,u,v,C,16,r[42]),v=d(v,t,p,u,m,23,r[43]),u=d(u,v,t,p,x,4,r[44]),p=d(p,u,v,t,K,11,r[45]),t=d(t,p,u,v,E,16,r[46]),v=d(v,t,p,u,g,23,r[47]),u=h(u,v,t,p,k,6,r[48]),p=h(p,u,v,t,A,10,r[49]),t=h(t,p,u,v,U,15,r[50]),v=h(v,t,p,u,D,21,r[51]),u=h(u,v,t,p,K,6,r[52]),p=h(p,u,v,t,C,10,r[53]),t=h(t,p,u,v,y,15,r[54]),v=h(v,t,p,u,B,21,r[55]),u=h(u,v,t,p,J,6,r[56]),p=h(p,u,v,t,E,10,r[57]),t=h(t,p,u,v,m,15,r[58]),v=h(v,t,p,u,F,21,r[59]),u=h(u,v,t,p,q,6,r[60]),p=h(p,u,v,t,I,10,r[61]),t=h(t,p,u,v,g,15,r[62]),v=h(v,t,p,u,x,21,r[63]);w[0]=w[0]+u|0;w[1]=w[1]+v|0;w[2]=w[2]+t|0;w[3]=w[3]+p|0},_doFinalize:function(){var d=this._data,c=d.words,e=8*this._nDataBytes,h=8*d.sigBytes;c[h>>>5]|=128<<24-h%32;var f=a.floor(e/4294967296);c[(h+64>>>9<<4)+15]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360;c[(h+64>>>9<<4)+14]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;d.sigBytes=4*(c.length+1);this._process();d=this._hash;c=d.words;for(e=0;4>e;e++)h=c[e],c[e]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360;return d},clone:function(){var a=q.clone.call(this);a._hash=this._hash.clone();return a}});w.MD5=q._createHelper(f);w.HmacMD5=q._createHmacHelper(f)})(Math);(function(a){for(var e=Y,c=e.lib,d=c.WordArray,h=c.Hasher,c=e.algo,f=[],k=[],q=function(a){return 4294967296*(a-(a|0))|0},m=2,r=0;64>r;){var x;a:{x=m;for(var y=a.sqrt(x),F=2;F<=y;F++)if(!(x%F)){x=!1;break a}x=!0}x&&(8>r&&(f[r]=q(a.pow(m,.5))),k[r]=q(a.pow(m,1/3)),r++);m++}var E=[],c=c.SHA256=h.extend({_doReset:function(){this._hash=new d.init(f.slice(0))},_doProcessBlock:function(a,d){for(var c=this._hash.words,e=c[0],h=c[1],f=c[2],w=c[3],B=c[4],r=c[5],C=c[6],q=c[7],m=0;64>m;m++){if(16>m)E[m]=a[d+m]|0;else{var A=E[m-15],x=E[m-2];E[m]=((A<<25|A>>>7)^(A<<14|A>>>18)^A>>>3)+E[m-7]+((x<<15|x>>>17)^(x<<13|x>>>19)^x>>>10)+E[m-16]}A=q+((B<<26|B>>>6)^(B<<21|B>>>11)^(B<<7|B>>>25))+(B&r^~B&C)+k[m]+E[m];x=((e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22))+(e&h^e&f^h&f);q=C;C=r;r=B;B=w+A|0;w=f;f=h;h=e;e=A+x|0}c[0]=c[0]+e|0;c[1]=c[1]+h|0;c[2]=c[2]+f|0;c[3]=c[3]+w|0;c[4]=c[4]+B|0;c[5]=c[5]+r|0;c[6]=c[6]+C|0;c[7]=c[7]+q|0},_doFinalize:function(){var c=this._data,d=c.words,e=8*this._nDataBytes,h=8*c.sigBytes;d[h>>>5]|=128<<24-h%32;d[(h+64>>>9<<4)+14]=a.floor(e/4294967296);d[(h+64>>>9<<4)+15]=e;c.sigBytes=4*d.length;this._process();return this._hash},clone:function(){var a=h.clone.call(this);a._hash=this._hash.clone();return a}});e.SHA256=h._createHelper(c);e.HmacSHA256=h._createHmacHelper(c)})(Math);var aa=null,ia=Object.prototype.toString;P.on=function(){for(var a,e=P.on.prototype,c=0,d=arguments.length;c<d;c++)a=arguments[c].prototype,a.bind=a.addEventListener=e.addEventListener,a.unbind=a.removeEventListener=e.removeEventListener,a.trigger=a.dispatchEvent=e.dispatchEvent};P.on.prototype={addEventListener:function(a,e){var c=this.__listeners=this.__listeners||{};c[a]=c[a]||[];c[a].push(e);return this},dispatchEvent:function(a,e){var c=this.__listeners=this.__listeners||{};a=a.type?a:new P(a);c=c[a.type];"[object Array]"===Object.prototype.toString.call(e)?e.unshift(a):e=[a,e];if(c)for(var d=0,h=c.length;d<h;d++)c[d].apply(this,e);return this},removeEventListener:function(a,e){var c=this.__listeners=this.__listeners||{};if(c[a])if(e)for(var c=c[a],d=c.length;d--;d)c[d]===e&&c.splice(d,1);else delete c[a];return this}};var E=function(){function a(w){var g={},B;for(B in a.settings)g[B]=a.settings[B];if(w)for(B in w)g[B]=w[B];"jsonp"===g.dataType&&(g.type="GET");var C,A,J,y=g.type.toUpperCase(),E=h.test(y),G,I,U=f,K;g.url=g.url.replace(F,"");g.context=w&&null!=w.context?w.context:g;g.data&&g.processData&&"string"!==typeof g.data&&(g.data=e(g.data,g.traditional));var R=r.exec(g.url);B=f.location;R=R&&(R[1]&&R[1]!==B.protocol||R[2]!==B.host);/https?:/i.test(B.protocol)||(R=!1);R=g.forceRemote?!0:R;"jsonp"!==g.dataType||R||(g.dataType="json");"jsonp"===g.dataType&&("GET"===y?k.test(g.url)||(g.url+=(m.test(g.url)?"\x26":"?")+(g.jsonp||"callback")+"\x3d?"):g.data&&k.test(g.data)||(g.data=(g.data?g.data+"\x26":"")+(g.jsonp||"callback")+"\x3d?"),g.dataType="json");if("json"===g.dataType&&(g.data&&k.test(g.data)||k.test(g.url))){C=g.jsonpCallback||"jsonp"+c++;g.data&&(g.data=(g.data+"").replace(k,"\x3d"+C+"$1"));g.url=g.url.replace(k,"\x3d"+C+"$1");g.dataType="script";var P=f[C],M=!1;f[C]=function(a){if(!M){M=!0;if("[object Function]"===Object.prototype.toString.call(P))P(a);else{f[C]=N;try{delete f[C]}catch(b){}}J=a;H.handleSuccess(g,z,A,J);H.handleComplete(g,z,A,J);G&&G.removeChild(K);I&&I.parentNode&&I.parentNode.removeChild(I)}}}"script"===g.dataType&&null===g.cache&&(g.cache=!1);if(!1===g.cache&&"GET"===y){var u=(new Date).getTime(),v=g.url.replace(x,"$1_\x3d"+u);g.url=v+(v===g.url?(m.test(g.url)?"\x26":"?")+"_\x3d"+u:"")}g.data&&"GET"===y&&(g.url+=(m.test(g.url)?"\x26":"?")+g.data);g.global&&H.active++;if("script"===g.dataType&&"GET"===y&&R){var t=function(){var a;try{a=U.document}catch(l){a=f.document}G=G||a.getElementsByTagName("head")[0]||a.documentElement;K=a.createElement("script");g.scriptCharset&&(K.charset=g.scriptCharset);K.src=g.url;d&&(K.async=g.async);if(C)K.onload=K.onerror=K.onreadystatechange=function(b){M||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(M=!0,H.handleError(g,z,"error","load error"),G&&K.parentNode&&G.removeChild(K),I&&I.parentNode&&I.parentNode.removeChild(I))};else{var b=!1;K.onload=K.onreadystatechange=function(){b||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(b=!0,H.handleSuccess(g,z,A,J),H.handleComplete(g,z,A,J),K.onload=K.onreadystatechange=null,G&&K.parentNode&&G.removeChild(K))}}G.insertBefore(K,G.firstChild)};w=!1;C&&g.async&&!d&&(f._fragmentProxy?G=I=q.createDocumentFragment():(w=!0,"/"==g.url.slice(0,1)?g.url=B.protocol+"//"+B.host+(B.port?":"+B.port:"")+g.url:/^https?:\/\//i.test(g.url)||(B=B.href,y=/([^?#]+)\//.exec(B),g.url=(y?y[1]:B)+"/"+g.url),g.url=g.url.replace("\x3d"+C,"\x3dparent."+C),I=q.createElement("iframe"),I.style.position="absolute",I.style.left="-100px",I.style.top="-100px",I.style.height="1px",I.style.width="1px",I.style.visibility="hidden",q.body.insertBefore(I,q.body.firstChild),U=I.contentWindow));w?setTimeout(function(){t()},0):t();return N}var p=!1,z=g.xhr();if(z){g.username?z.open(y,g.url,g.async,g.username,g.password):z.open(y,g.url,g.async);try{(null!=g.data&&!E||w&&w.contentType)&&z.setRequestHeader("Content-Type",g.contentType),g.ifModified&&(H.lastModified[g.url]&&z.setRequestHeader("If-Modified-Since",H.lastModified[g.url]),H.etag[g.url]&&z.setRequestHeader("If-None-Match",H.etag[g.url])),R||z.setRequestHeader("X-Requested-With","XMLHttpRequest"),z.setRequestHeader("Accept",g.dataType&&g.accepts[g.dataType]?g.accepts[g.dataType]+", */*; q\x3d0.01":g.accepts._default)}catch(la){}if(g.beforeSend&&!1===g.beforeSend.call(g.context,z,g))return g.global&&H.active--,z.abort(),!1;g.global&&H.triggerGlobal(g,"ajaxSend",[z,g]);var O=z.onreadystatechange=function(a){if(!z||0===z.readyState||"abort"===a)p||H.handleComplete(g,z,A,J),p=!0,z&&(z.onreadystatechange=H.noop);else if(!p&&z&&(4===z.readyState||"timeout"===a)){p=!0;z.onreadystatechange=H.noop;A="timeout"===a?"timeout":H.httpSuccess(z)?g.ifModified&&H.httpNotModified(z,g.url)?"notmodified":"success":"error";var b;if("success"===A)try{J=H.httpData(z,g.dataType,g)}catch(l){A="parsererror",b=l}"success"===A||"notmodified"===A?C||H.handleSuccess(g,z,A,J):H.handleError(g,z,A,b);C||H.handleComplete(g,z,A,J);"timeout"===a&&z.abort();g.async&&(z=null)}};try{var Q=z.abort;z.abort=function(){z&&Q.call&&Q.call(z);O("abort")}}catch(la){}g.async&&0<g.timeout&&setTimeout(function(){z&&!p&&O("timeout")},g.timeout);try{z.send(E||null==g.data?null:g.data)}catch(la){H.handleError(g,z,null,la),H.handleComplete(g,z,A,J)}g.async||O();return z}}function e(a){var c=[];if("object"==typeof a){for(var d in a)c[c.length]=encodeURIComponent(d)+"\x3d"+encodeURIComponent(a[d]);return c.join("\x26").replace(y,"+")}return a}var c=(new Date).getTime(),d="boolean"===typeof q.createElement("script").async,h=/^(?:GET|HEAD|DELETE)$/,w=/\S/,k=/\=\?(&|$)/,m=/\?/,x=/([?&])_=[^&]*/,r=/^(\w+:)?\/\/([^\/?#]+)/,y=/%20/g,F=/#.*$/;f._fragmentProxy=!1;var E=q.createDocumentFragment(),G=q.createElement("script");try{G.appendChild(q.createTextNode("window._fragmentProxy \x3d true"))}catch(B){G.text="window._fragmentProxy \x3d true"}E.appendChild(G);E=G=null;a.param=e;var H={noop:function(){},active:0,lastModified:{},etag:{},handleError:function(a,c,d,e){a.error&&a.error.call(a.context,c,d,e);a.global&&H.triggerGlobal(a,"ajaxError",[c,a,e])},handleSuccess:function(a,c,d,e){a.success&&a.success.call(a.context,e,d,c);a.global&&H.triggerGlobal(a,"ajaxSuccess",[c,a])},handleComplete:function(a,c,d){a.complete&&a.complete.call(a.context,c,d);a.global&&H.triggerGlobal(a,"ajaxComplete",[c,a]);a.global&&H.active--},triggerGlobal:function(a,c,d){},httpSuccess:function(a){try{return!a.status&&"file:"===location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status}catch(g){}return!1},httpNotModified:function(a,c){var d=a.getResponseHeader("Last-Modified"),e=a.getResponseHeader("Etag");d&&(H.lastModified[c]=d);e&&(H.etag[c]=e);return 304===a.status},httpData:function(a,c,d){var e=a.getResponseHeader("content-type")||"",h="xml"===c||!c&&0<=e.indexOf("xml");a=h?a.responseXML:a.responseText;h&&"parsererror"===a.documentElement.nodeName&&H.error("parsererror");d&&d.dataFilter&&(a=d.dataFilter(a,c));if("string"===typeof a)if("json"===c||!c&&0<=e.indexOf("json"))a=a?f.JSON&&f.JSON.parse?f.JSON.parse(a):(new Function("return "+a))():a;else if(("script"===c||!c&&0<=e.indexOf("javascript"))&&a&&w.test(a)){c=q.getElementsByTagName("head")[0]||q.documentElement;d=q.createElement("script");d.type="text/javascript";try{d.appendChild(q.createTextNode(a))}catch(Z){d.text=a}c.insertBefore(d,c.firstChild);c.removeChild(d)}return a}};a.settings={url:location.href,global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,xhr:function(){return new f.XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}};a.setup=function(c){if(c)for(var d in c)a.settings[d]=c[d]};f.ActiveXObject&&(a.settings.xhr=function(){if("file:"!==f.location.protocol)try{return new f.XMLHttpRequest}catch(B){}try{return new f.ActiveXObject("Microsoft.XMLHTTP")}catch(B){}});return a}(),T=f.JSON?f.JSON:function(){function a(a){return c[a]||"\\u00"+Math.floor(a.charCodeAt()/16).toString(16)+(a.charCodeAt()%16).toString(16)}function e(c){switch(Object.prototype.toString.call(c)){case "[object String]":return'"'+c.replace(/[\x00-\x1f\\\"]/g,a)+'"';case "[object Array]":for(var d=[],f=c.length,k=0;k<f;k++)d.push(e(c[k]));return"["+d.join(",")+"]";case "[object Object]":d=[];for(f in c)(k=e(c[f]))&&d.push(e(f)+":"+k);return"{"+d+"}";case "[object Number]":case "[object Boolean]":return String(c);case !1:return"null"}return null}var c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:e,parse:function(a){return(a=a.toString())&&a.length?(new Function("return "+a))():null}}}();y.prototype={readyState:0,send:function(a){},_setting:function(){this.readyState=y.CLOSED;this._onPolling=this._connecting=!1;this._pollTimer=null;this._failTimes=this._pollingTimes=0},_connect:function(){var a=this;if(a._connecting)return a;a.readyState=y.CONNECTING;a._connecting=!0;a._onPolling||f.setTimeout(function(){a._startPolling()},300);return a},close:function(){this._pollTimer&&clearTimeout(this._pollTimer);this._setting();return this},_onConnect:function(){this.readyState=y.OPEN;this.trigger("open","success")},_onClose:function(a){var e=this;e._setting();setTimeout(function(){e.trigger("close",[a])},1E3)},_onData:function(a){this.trigger("message",[a])},_onError:function(a){var e=this;e._setting();setTimeout(function(){e.trigger("error",[a])},1E3)},_startPolling:function(){this._connecting&&(this._onPolling=!0,this._pollingTimes++,E({url:this.URL,dataType:"jsonp",cache:!1,context:this,success:this._onPollSuccess,error:this._onPollError}))},_onPollSuccess:function(a){var e=this;e._onPolling=!1;if(e._connecting)if(a)1==e._pollingTimes&&e._onConnect(),e._onData(a),e._failTimes=0,e._pollTimer=f.setTimeout(function(){e._startPolling()},200);else return e._onError("error data")},_onPollError:function(a){var e=this;e._onPolling=!1;e._connecting&&(e._failTimes++,1==e._pollingTimes?e._onError("can not connect."):1<e._failTimes?e._onClose(a):e._pollTimer=f.setTimeout(function(){e._startPolling()},200))}};y.CONNECTING=0;y.OPEN=1;y.CLOSED=2;P.on(y);m.prototype={readyState:0,send:function(a){},close:function(){this.ws.close()}};m.enable=!!f.WebSocket;m.CONNECTING=0;m.OPEN=1;m.CLOSED=2;P.on(m);P.on(k);k.OFFLINE=0;k.BEFOREONLINE=1;k.ONLINE=2;x(k.prototype,{state:k.OFFLINE,_init:function(){var a=this.options;this.data={user:{presence:"offline",show:"unavailable"}};this.models={};E.settings.dataType=a.jsonp?"jsonp":"json";this.status=new k.status;this.setting=new k.setting;this.models.presence=new k.presence;this.buddy=new k.buddy;this.history=new k.history(null,this.data);this._initEvents()},_createConnect:function(){var a=this,e=a.data.connection;a.connection="jsonpd"!=a.options.connectionType&&e.websocket&&m.enable?new m(e.websocket,e):new y(e.server+(/\?/.test(e)?"\x26":"?")+E.param({ticket:e.ticket,domain:e.domain}));a.connection.bind("connect",function(a,d){}).bind("message",function(c,d){a.handle(d)}).bind("error",function(c,d){a._stop("connect","Connect Error")}).bind("close",function(c,d){a._stop("connect","Disconnect")})},setUser:function(a){x(this.data.user,a)},_ready:function(a){this.state=k.BEFOREONLINE;this.trigger("beforeOnline",[a])},_go:function(){var a=this.data,e=this.history,c=this.buddy,d=this.models.presence;this.state=k.ONLINE;e.options.userInfo=a.user;F(a.buddies,function(a,c){e.init("chat",c.id,c.history)});c.set(a.buddies);a.presences?d.set(a.presences):d.set(X(a.buddies,function(a){var c={};c[a.id]=a.show;return c}));this.trigger("online",[a]);this._createConnect();c=[];a.new_messages&&(c=c.concat(a.new_messages));a.offline_messages&&(c=c.concat(a.offline_messages));c&&c.length&&(F(c,function(a,c){c["new"]=!0}),this.trigger("message",[c]))},_stop:function(a,e){this.state!==k.OFFLINE&&(this.state=k.OFFLINE,this.data.user.presence="offline",this.data.user.show="unavailable",this.buddy.clear(),this.models.presence.clear(),this.history.clean(),this.trigger("offline",[a,e]))},autoOnline:function(){return!this.status.get("o")},_initEvents:function(){function a(a){var c={id:a.from,presence:a.type};a.show&&(c.show=a.show);a.nick&&(c.nick=a.nick);a.status&&(c.status=a.status);return c}function e(a){return"online"==a.type||"offline"==a.type||"show"==a.type}var c=this,d=c.history,h=c.buddy,f=c.models.presence;c.bind("message",function(a,e){for(var f=[],w=e.length,k=c.data.user.id,m,q,C,A=0;A<w;A++)m=e[A],C=m.type,q="chat"==C?m.to==k?m.from:m.to:m.to,m.id=q,"chat"!=C||m["new"]||(q={id:q,presence:"online"},m.nick&&m.to==k&&(q.nick=m.nick),f.push(q));f.length&&(h.presence(f),h.complete());d.set(e)});c.bind("presence",function(c,d){var w=O(d,e);h.presence(X(w,a));f.update(w)});c.bind("mypresence",function(a,c){F(c,function(a,c){var d=c.show,e=k.ui.i18n(d);(":userShow".nodeType?":userShow":q.getElementById(":userShow")).innerHTML='\x3cem class\x3d"webim-icon webim-icon-'+d+'"\x3e'+e+"\x3c/em\x3e"+e})});c.bind("notifications",function(a,c){F(c,function(a,c){"notification"in webimUI.im&&"handle"in webimUI.im.notification&&webimUI.im.notification.handle(c)})})},handle:function(a){if(a.type&&"ping"==a.type)this.connection.ws.send(T.stringify({type:"pong"}));else if(a.status&&"ping"==a.status)this.connection.ws.send(T.stringify({type:"pong"}));else if(a.status&&"reload"==a.status)alert("\u804a\u5929\u7cfb\u7edf\u957f\u65f6\u95f4\u505c\u6ede\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01"),location.reload();else{if(a.messages&&a.messages.length){for(var e=a.messages,c=[],d=[],h=0;h<e.length;h++){var f=e[h];f.body&&0==f.body.indexOf("webim-event:")?(f.event=f.body.replace("webim-event:","").split("|,|"),d.push(f)):c.push(f)}c.length&&this.trigger("message",[c]);d.length&&this.trigger("event",[d])}a.status&&"logout"==a.status&&this.offline();a.presences&&a.presences.length&&this.trigger("presence",[a.presences]);a.statuses&&a.statuses.length&&this.trigger("status",[a.statuses]);a.mypresence&&a.mypresence.length&&this.trigger("mypresence",[a.mypresence]);a.notifications&&a.notifications.length&&this.trigger("notifications",[a.notifications])}},sendMessage:function(a,e){ea("line 1590 sendMessage",a,c,this);var c=this,d=/\[roomid=([0-9]+)\ image\=http:\/\/assets.muniao.com\/([0-9a-zA-Z\/\.\_]+) priceday\=(.*) privacy\=(.*) propertytype\=(.*) accommodates\=(.*)\](.+)\[\/roomid\]/ig.exec(a.body||""),h={type:"chat",to:a.to||0,body:a.body,utype:_IMC.user.type||"0"};d&&(h.type="send_room",h.body="",h.roomid=d[1]||0,h.image="http://assets.muniao.com/"+d[2]||0,h.priceday=d[3]||0,h.privacy=d[4]||0,h.propertytype=d[5]||0,h.accommodates=d[6]||0,h.title=d[7]||0,h.csrf_token=_IMC.token_key||"");c.trigger("sendMessage",[a]);E({type:"get",cache:!1,dataType:"jsonp",url:M("send_message")+"",data:h,success:function(a){console.log("send success",a,a)},error:function(a){console.log("send error",a)}})},sendStatus:function(a,e){this.trigger("sendStatus",[a]);_json='{"type":"status","to":"'+a.to+'","show":"'+a.show+'"}';this.connection.ws.send(_json)},sendPresence:function(a,e){this.data.user.show=a.show;this.status.set("s",a.show);this.trigger("sendPresence",[a]);this.connection.ws.send('{"type":"presence","show":"'+a.show+'"}')},online:function(a){var e=this,c=e.status;if(e.state===k.OFFLINE){var d=[],h=c.get("tabs"),w=c.get("tabIds");w&&w.length&&h&&F(h,function(a,c){"b"==a[0]&&d.push(a.slice(2))});h=guid.getGUIDDate()+guid.getGUIDTime();w=Y.MD5(h+_IMC.token_key).toString();a=x({buddy_ids:d.join(","),csrf_token:_IMC.token_key,crrf_token:w,crrf_time:h,crrf_crypto:"md5",show:c.get("s")||"available",utype:_IMC.user.type||"0"},a);e._ready(a);c.set("o",!1);c.set("s",a.show);1==f.WEB_SOCKET_DEBUG&&(a.debug=1);E({type:"get",cache:!1,dataType:"jsonp",url:M("online")+"",data:a,success:function(a){a?a.success?1==a.refresh?location.reload():(a.user=x(e.data.user,a.user,{presence:"online"}),e.data=a,e._go()):e._stop("online",a.error_msg):e._stop("online","Not Found")},error:function(a){e._stop("online","Not Found")}})}},offline:function(){this.state!==k.OFFLINE&&(this.status.set("o",!0),this.connection.close(),this._stop("offline","offline"))}});f.webim=k;x(k,{version:"5.5",defaults:{},log:ea,idsArray:ga,now:function(){return(new Date).getTime()},isFunction:V,isArray:W,isObject:da,trim:ba,makeArray:Q,extend:x,each:F,inArray:function(a,e){for(var c=0,d=e.length;c<d;c++)if(e[c]===a)return c;return-1},grep:O,map:X,JSON:T,ajax:E,comet:y,socket:m,model:G,route:M,ClassEvent:P});G("setting",{data:{play_sound:!0,buddy_sticky:!0,minimize_layout:!0,msg_auto_pop:!0}},{_init:function(){this.data=x({},this.options.data,this.data)},get:function(a){return this.data[a]},set:function(a,e){var c=this,d=a;if(a){"string"==typeof a&&(d={},d[a]=e);var h=c.data,f=ca(h,d);f&&(F(f,function(a,d){c.trigger("update",[a,d])}),d=x({},h,d),c.data=d,E({type:"get",dataType:"jsonp",url:M("setting"),cache:!1,data:{data:T.stringify(d),csrf_token:_IMC.token_key}}))}}});G("status",{key:"_webim"},{_init:function(){var a=this.data,e=this.options.key,c=f.localStorage;if(c)try{c.setItem("__store_webim__","__store_webim__"),"__store_webim__"==c.getItem("__store_webim__")&&(this.store=c),c.removeItem("__store_webim__")}catch(d){this.store=N}a?this._save(a):this.data=(a=this.store?this.store.getItem(e):fa(e))?T.parse(a):{}},set:function(a,e){var c=a;"string"==typeof a&&(c={},c[a]=e);var d=this.data;ca(d,c)&&(c=x({},d,c),this._save(c))},get:function(a){return this.data[a]},clear:function(){this._save({})},_save:function(a){var e=this.options.key;this.data=a;a=T.stringify(a);this.store?this.store.setItem(e,a):fa(e,a,{path:"/",domain:q.domain})}});G("buddy",{active:!0},{_init:function(){this.data=this.data||[];this.dataHash={};this.set(this.data)},remove:function(a){var e=this.get(a);e&&(E({type:"get",dataType:"jsonp",url:M("remove_buddy"),cache:!1,data:{id:a,csrf_token:_IMC.token_key,utype:_IMC.user.type||"0"},success:function(a){}}),this.trigger("unsubscribe",[[e]]),delete this.dataHash[a])},clear:function(){this.data=[];this.dataHash={}},count:function(a){var e=this.dataHash,c=0,d,h;for(h in e)if(da(a)){d=!0;for(var f in a)a[f]!=e[h][f]&&(d=!1);d&&c++}else c++;return c},get:function(a){return this.dataHash[a]},all:function(a){return a?O(this.data,function(a){return"invisible"!=a.show&&"online"==a.presence}):this.data},complete:function(){var a=this.dataHash,e=[],c,d;for(d in a)c=a[d],c.incomplete&&(c.incomplete=!1,e.push(d));this.load(e)},update:function(a){this.load(a)},presence:function(a){var e=this.dataHash;a=W(a)?a:[a];for(var c in a){var d=a[c];d.presence="offline"==d.presence?"offline":"online";d.incomplete=!e[d.id];!d.group&&d.id&&(d.group=0==d.id.indexOf("vid:")?"visitor":d.group)}this.set(a)},load:function(a){a=ga(a);a.length&&E({type:"get",dataType:"jsonp",url:M("buddies"),cache:!1,data:{ids:a.join(","),csrf_token:_IMC.token_key,utype:_IMC.user.type||"0"},context:this,success:this.set})},set:function(a){var e=this.data,c=this.dataHash,d={};a=a||[];for(var f=a.length,k,m,q,y=0;y<f;y++)if(k=a[y],q=k.id)if(c[q]||(k.presence=k.presence||"online",k.show=k.show?k.show:"offline"==k.presence?"unavailable":"available",c[q]={},e.push(c[q])),k.incomplete=!!k.incomplete,m=ca(c[q],k))k=m.presence||"update",d[k]=d[k]||[],x(c[q],m),d[k].push(c[q]);for(var r in d)this.trigger(r,[d[r]]);this.options.active&&this.complete()}});G("presence",{},{_init:function(){this.data=this.data||{};this.set(this.data)},get:function(a){return this.data[a]},set:function(a){var e={},c;for(c in a){var d=a[c],f="online";if("unavailable"==d||"invisible"==d)f="offline";e[f]=e[f]||[];e[f].push({id:c,show:d})}for(var k in e)this.trigger(k,[e[k]])},update:function(a){for(var e={},c=0;c<a.length;c++){var d=a[c];e[d.from]=d.show}this.set(e)},clear:function(){this.data=[]}});G("history",{},{_init:function(){this.data=this.data||{};this.data.chat=this.data.chat||{};this.data.grpchat=this.data.grpchat||{}},clean:function(){this.data.chat={};this.data.grpchat={}},get:function(a,e){return this.data[a][e]},set:function(a){var e=this.data,c={chat:{},grpchat:{}};a=Q(a);var d=a.length,f,k,m=this.options.userInfo.id;if(d){for(var q=0;q<d;q++)f=a[q],x=f.type,(k="chat"==x?f.to==m?f.from:f.to:f.to)&&x&&(c[x][k]=c[x][k]||[],c[x][k].push(f));for(var x in c)for(k in c[x])f=c[x][k],e[x][k]?(e[x][k]=[].concat(e[x][k]).concat(f),this._triggerMsg(x,k,f)):this.load(x,k)}},_triggerMsg:function(a,e,c){this.trigger(a,[e,c])},clear:function(a,e){this.data[a][e]=[];this.trigger("clear",[a,e])},init:function(a,e,c){W(c)&&(this.data[a][e]=c,this._triggerMsg(a,e,c))},load:function(a,e){var c=this;c.data[a][e]=[];var d=guid.getGUIDDate()+guid.getGUIDTime(),f=Y.MD5(d+_IMC.token_key).toString();E({dataType:"jsonp",url:M("history"),cache:!1,type:"get",data:{type:a,id:e,utype:_IMC.user.type||"0",csrf_token:_IMC.token_key,crrf_token:f,crrf_time:d,crrf_crypto:"md5"},success:function(d){d&&1==d.refresh?location.reload():c.init(a,e,d)}})}})})(window,document);(function(f,q,N){function V(){return!1}function W(b){if(0==b.length)return"";b=b.replace(/&/g,"\x26amp;");b=b.replace(/</g,"\x26lt;");b=b.replace(/>/g,"\x26gt;");b=b.replace(/ /g,"\x26nbsp;");b=b.replace(/\t/g,"\x26nbsp;");b=b.replace(/\'/g,"\x26#39;");b=b.replace(/\"/g,"\x26quot;");return b=b.replace(/\n/g,"\x3cbr\x3e")}function da(b){return/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"])*$/.test(b)}function ba(b){return b?b.replace(/<(?:.|\s)*?>/g,""):""}function ca(b,a){for(var l=[];b;b=b.nextSibling)1==b.nodeType&&b!=a&&l.push(b);return l}function Q(b,a){return b&&(new RegExp("(^|\\s+)"+a+"(\\s+|$)")).test(b.className)}function x(b,a){b&&!Q(b,a)&&(b.className+=" "+a)}function F(b,a){b&&(b.className=b.className.replace(new RegExp("(^|\\s+)("+a.split(/\s+/).join("|")+")(?\x3d(\\s+|$))","g")," "))}function O(b,a,n){b&&(b.className=b.className.replace(new RegExp("(^|\\s+)("+a.split(/\s+/).join("|")+")(?\x3d(\\s+|$))","g")," ")+" "+n)}function X(b,a,n){k(b,"mouseover",function(){x(this,a);n&&F(this,n)});k(b,"mouseout",function(){F(this,a);n&&x(this,n)})}function P(b,a,n){"boolean"===typeof n?n?x(b,a):F(b,a):Q(b,a)?F(b,a):x(b,a)}function y(b){b&&b.style&&(b.style.display="block")}function m(b){b&&b.style&&(b.style.display="none")}function fa(b){b&&b.parentNode&&b.parentNode.removeChild(b)}function ea(b,a){var l=b.childNodes;for(i=0;i<l.length;i++)b.removeChild(l[i]);"string"===typeof a?b.innerHTML=a:b.appendChild(a)}function k(b,a,n){b.addEventListener?b.addEventListener(a,n,!1):(b["e"+a+n]=n,b[a+n]=function(){return b["e"+a+n](f.event)},b.attachEvent("on"+a,b[a+n]))}function ga(b){b&&(b.stopPropagation&&b.stopPropagation(),b.cancelBubble=!0)}function G(b){b&&(b.preventDefault&&b.preventDefault(),"returnValue"in b&&(b.returnValue=!1))}function M(b){b.target||(b.target=b.srcElement||q);3===b.target.nodeType&&(b.target=b.target.parentNode);return b.target}function Y(b){b.setAttribute("unselectable","on");b.style.MozUserSelect="none";b.style.OUserSelect="none";b.style.WebkitUserSelect="none";k(b,"selectstart",V)}function aa(){if(!ma&&(ma=!0,K)){for(var b,a=0;b=K[a++];)b();K=null}}function ia(){if(!R){R=!0;if("complete"===q.readyState)return aa();q.addEventListener?q.addEventListener("DOMContentLoaded",function(){q.removeEventListener("DOMContentLoaded",arguments.callee,!1);aa()},!1):q.attachEvent&&(q.attachEvent("onreadystatechange",function(){"complete"===q.readyState&&(q.detachEvent("onreadystatechange",arguments.callee),aa())}),q.documentElement.doScroll&&f==f.top&&function(){if(!ma){try{q.documentElement.doScroll("left")}catch(b){setTimeout(arguments.callee,0);return}aa()}}());k(f,"load",aa)}}function E(b){var a=new Date;a.setTime(b?parseFloat(b)+E.timeSkew:(new Date).getTime());this.date=a}function T(b,a,n){b.addEventListener?b.addEventListener(a,n,!1):(b["e"+a+n]=n,b[a+n]=function(){return b["e"+a+n](f.event)},b.attachEvent("on"+a,b[a+n]))}function a(b){b&&b.parentNode&&b.parentNode.removeChild(b)}function e(b){return b?f.JSON&&f.JSON.parse?f.JSON.parse(b):(new Function("return "+b))():b}function c(b,l,n){T(b,"submit",function(c){function d(){try{var b=g.contentWindow.name||null;if(null!=b)a(S),l&&l(e(b));else throw Error("Empty data");}catch(xa){a(S),l&&l({error:"Retrieve data error"})}}n&&n();b.setAttribute("target","_upload_form13123");var S=q.createElement("div");S.innerHTML='\x3ciframe name\x3d"_upload_form13123" id\x3d"_upload_form13123" style\x3d"display:none;" scrolling\x3d"no" frameborder\x3d"0"\x3e\x3c/iframe\x3e';var g=S.firstChild;q.body.appendChild(S);if(f.postMessage){var h=function(b){var n=h;f.addEventListener?f.removeEventListener("message",n,!1):(f.detachEvent("onmessage",f["message"+n]),f["message"+n]=null);a(S);l&&l(e(b.data))};T(f,"message",h)}else{var k=!1;T(g,"load",function(b){k?f.attachEvent||d():(k=!0,g.contentWindow.location="about:blank")});f.attachEvent&&(g.onreadystatechange=function(){k&&d()})}})}function d(b,a,n){n=L({locale:d.locale},n);n=d.dictionary[n.locale];B(n)||(n={});b=n[b]===N?b:n[b];if(a){u=a;for(var l in a)b=b.replace(/\{\{(.*?)\}\}/g,v)}return b}function h(b,a){this.element=b;this.options=L({},h.defaults,a);this._init()}function w(b){b=b.getElementsByTagName("*");for(var a,n,c={},d=b.length-1;-1<d;d--)a=b[d],(n=a.id)&&0==n.indexOf(":")&&(c[n.substring(1,n.length)]=a);return c}function C(b){var a=q.createElement("div");a.innerHTML=b;return a=a.firstChild}function A(b,a,n){function l(a,n){this.id=ta++;this.name=b;this.className="webim-"+b;this.options=L({},l.defaults,n);if(this.element=a||this.template&&C(this.template())||this.options.template&&C(p(this.options.template)))this.options.className&&x(this.element,this.options.className),this.$=w(this.element);na(this._init)&&this._init();na(this._initEvents)&&this._initEvents()}l.defaults=a;pa.on(l);L(l.prototype,A.prototype,n);h[b]=l}function J(b,a){h.apps[b]=a||{}}function r(b,a){return a?"b"==b||"buddy"==b||"chat"==b?"b_"+a:"r_"+a:b}function oa(b){q.selection&&(this.caretPos=q.selection.createRange())}var I=webim.log,U=webim.idsArray,na=webim.isFunction,H=webim.isArray,B=webim.isObject,g=webim.trim,ja=webim.makeArray,L=webim.extend,D=webim.each,Z=webim.grep,qa=webim.model,pa=webim.ClassEvent,ra=webim.route,ka=webim.map,ma=!1,K=[],R=!1;E.timeSkew=0;E.init=function(b){E.timeSkew=(new Date).getTime()-parseFloat(b)};L(E.prototype,{getTime:function(){var b=this.date,a=b.getHours(),b=b.getMinutes();10>b&&(b="0"+b);return a+":"+b+""},getDay:function(b){var a=this.date;if(b){b=new Date;b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0);b=b.getTime()-a.getTime();if(0>=b)return d("dt:today");if(864E5>b)return d("dt:yesterday")}return d("dt:monthdate",{month:d("dt:january dt:february dt:march dt:april dt:may dt:june dt:july dt:august dt:september dt:october dt:november dt:december".split(" ")[a.getMonth()]),date:a.getDate()})}});var ha=function(){var b=!0,a={lib:"sound.swf",msg:"sound/msg.mp3"};return{enable:function(){b=!0},disable:function(){b=!1},init:function(b){L(a,b);!f.Audio&&0<=navigator.userAgent.indexOf("MSIE")&&(b=q.createElement("bgsound"),b.id="webim-bgsound",b.src="#",b.autostart="true",b.loop="1",q.getElementById("webim-flashlib-c").appendChild(b))},play:function(l){l=da(l)?l:a[l];if(b)if(f.Audio){if(!n)var n=new Audio;n.src=l;n.play()}else if(0<=navigator.userAgent.indexOf("MSIE"))try{q.getElementById("webim-bgsound").src=l?l:"/sound/sound.mp3"}catch(va){}}}}(),sa=function(){var b=!1;k(f,"focus",function(){b=!1});k(f,"blur",function(){b=!0});var a=q.title,n=0,c=!1;return function(l,d){if(b){S&&(clearInterval(S),n=0,c=!1);var S=setInterval(function(){n++;c=!c;n!=d&&b||(clearInterval(S),n=0,c=!1);q.title=c?"["+l+"]"+a:a},1500)}}}(),u={},v=function(b,a){return u[a]||""};d.locale="zh-CN";d.dictionary={};d.store=function(b,a){var l=d.dictionary;B(l[b])||(l[b]={});L(l[b],a)};pa.on(h);L(h.prototype,{render:function(){var b=this,a=b.layout;b.element.insertBefore(a.element,b.element.firstChild);setTimeout(function(){b.initSound()},1E3);a.buildUI()},_init:function(){var b=this.im=new webim(null,this.options.imOptions),a=this.options;this.layout=this.addApp(a.layout||"layout",a.layoutOptions);b.setting.get("play_sound")?ha.enable():ha.disable();b.bind("online",function(b,a){E.init(a.server_time)});b.setting.bind("update",function(b,a,l){"play_sound"==a&&(l?ha.enable():ha.disable())})},addApp:function(b,a){var l=h.apps[b];if(l)return na(l)&&l.apply(this,[a])},initSound:function(b){ha.init(b||this.options.soundUrls)}});var t=function(b,a){if(a===N)return parseInt(b.innerHTML);a?(a="number"==typeof a?a:parseInt(b.innerHTML)+parseInt(a),b.innerHTML=a.toString(),y(b)):(b.innerHTML="0",m(b));return a},p=function(){function b(b,l){return a&&a[l]!=N?a[l]:d(l)}var a=null,n=/\<\%\=(.*?)\%\>/ig;return function(l,c){if(!l)return"";a=c;return l.replace(n,b)}}(),z={add:function(b,a,n){b=h[b].prototype;for(var l in n)b.plugins[l]=b.plugins[l]||[],b.plugins[l].push([a,n[l]])},call:function(b,a,n){if((a=b.plugins[a])&&b.element.parentNode)for(var l=0;l<a.length;l++)b.options[a[l][0]]&&a[l][1].apply(b.element,n)}},ta=1;L(A.prototype,{_init:function(){}});L(h,{version:"5.4 ",widget:A,app:J,plugin:z,i18n:d,date:E,ready:function(b){ia();ma?b():K.push(b)},createElement:C,defaults:{},apps:{}});webim.ui=h;A("window",{isMinimize:!1,minimizable:!0,detachable:!1,maximizable:!1,closeable:!0,sticky:!0,titleVisibleLength:12,count:0,template:'\x3cdiv id\x3d":webim-window" class\x3d"webim-window ui-widget"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"webim-window-tab-wrap"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\x3cdiv id\x3d":tab" class\x3d"webim-window-tab ui-state-default"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"webim-window-tab-inner"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3cdiv id\x3d":tabTip" class\x3d"webim-window-tab-tip"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3cstrong id\x3d":tabTipC"\x3e\x3c%\x3dtooltip%\x3e\x3c/strong\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3ca id\x3d":tabClose" title\x3d"\x3c%\x3dclose%\x3e" class\x3d"webim-window-close" href\x3d"#close"\x3e\x3cem class\x3d"ui-icon ui-icon-close"\x3e\x3c%\x3dclose%\x3e\x3c/em\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3cdiv id\x3d":tabCount" class\x3d"webim-window-tab-count"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3cem id\x3d":tabIcon" class\x3d"webim-icon webim-icon-comments"\x3e\x3c/em\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3ch4 id\x3d":tabTitle"\x3e\x3c%\x3dtitle%\x3e\x3c/h4\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\x3cdiv\x3e\x3cdiv id\x3d":window" class\x3d"webim-window-window"\x3e\r\n\x3c!--\t\t\t\t\t\t\t\x3ciframe id\x3d":bgiframe" class\x3d"webim-bgiframe" frameborder\x3d"0" tabindex\x3d"-1" src\x3d"about:blank;" \x3e\x3c/iframe\x3e--\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3cdiv id\x3d":header" class\x3d"webim-window-header ui-widget-header ui-corner-top"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3cspan id\x3d":actions" class\x3d"webim-window-actions"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3ca id\x3d":minimize" title\x3d"\x3c%\x3dminimize%\x3e" class\x3d"webim-window-minimize" href\x3d"javascript:void();"\x3e\x3cem class\x3d"ui-icon ui-icon-minus"\x3e\x3c%\x3dminimize%\x3e\x3c/em\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3ca id\x3d":detach" title\x3d"\x3c%\x3ddetach%\x3e" class\x3d"webim-window-detach" href\x3d"javascript:void();"\x3e\x3cem class\x3d"ui-icon ui-icon-arrowthick-1-ne"\x3e\x3c%\x3ddetach%\x3e\x3c/em\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3ca id\x3d":maximize" title\x3d"\x3c%\x3dmaximize%\x3e" class\x3d"webim-window-maximize" href\x3d"javascript:void();"\x3e\x3cem class\x3d"ui-icon ui-icon-plus"\x3e\x3c%\x3dmaximize%\x3e\x3c/em\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3ca id\x3d":close" title\x3d"\x3c%\x3dclose%\x3e" class\x3d"webim-window-close" href\x3d"javascript:void();"\x3e\x3cem class\x3d"ui-icon ui-icon-close"\x3e\x3c%\x3dclose%\x3e\x3c/em\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3c/span\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3ch4 id\x3d":headerTitle" style\x3d"overflow: hidden;height: 20px;margin: 0 0 0 52px;width: 170px;"\x3e\x3c%\x3dtitle%\x3e\x3c/h4\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3cdiv id\x3d":subHeader" class\x3d"webim-window-subheader"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3cdiv id\x3d":content" class\x3d"webim-window-content ui-widget-content"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e'},{html:function(b){ea(this.$.content,b)},subHeader:function(b){ea(this.$.subHeader,b)},_init:function(b,a){a=this.options;var l=this.$;b=this.element;b.window=this;a.tabWidth&&(l.tab.style.width=a.tabWidth+"px");a.subHeader&&this.subHeader(a.subHeader);this.title(a.title,a.icon);!a.minimizable&&m(l.minimize);!a.maximizable&&m(l.maximize);!a.detachable&&m(l.detach);a.closeable||(m(l.tabClose),m(l.close));a.isMinimize?this.minimize():this.restore();this.position={right:0,bottom:0};a.detached&&(this.position.right=a.detached.right,this.position.bottom=a.detached.bottom,this.detach());a.onlyIcon?m(l.tabTitle):fa(l.tabTip);a.count&&this.notifyUser("information",a.count);ua(this)},notifyUser:function(b,a){var l=this.$;"information"==b&&this.isMinimize()&&t(l.tabCount,a)&&(x(l.tab,"ui-state-highlight"),F(l.tab,"ui-state-default"))},_count:function(){return t(this.$.tabCount)},title:function(b,a){var l=this.$,c=l.tabIcon;a&&(da(a)?(c.className="webim-icon",c.style.backgroundImage="url("+a+")"):c.className="webim-icon webim-icon-"+a);l.tabTipC.innerHTML=b;c=this.options.titleVisibleLength;if(b){for(var d=0,e=[],f=b.split(""),g=f.length,h=0;h<g&&!(d>=c||0>d);h++)255<f[h].charCodeAt(0)?d+=2:d++,e.push(f[h]);c=e.join("")}else c=b;(l.tabTitle.innerHTML=c)&&b&&c.length<b.length&&l.tabTitle.setAttribute("title",b);l.headerTitle.innerHTML=b},_changeState:function(b){O(this.element,"webim-window-normal webim-window-maximize webim-window-minimize","webim-window-"+("restore"==b?"normal":b));this.trigger("displayStateChange",[b])},active:function(){return Q(this.element,"webim-window-active")},activate:function(){this.active()||(x(this.element,"webim-window-active"),this.trigger("activate"))},deactivate:function(){this.active()&&(F(this.element,"webim-window-active"),this.options.sticky||this.minimize(),this.trigger("deactivate"))},_setVisibile:function(){var b=this.$;this.isDetached()?m(b.tab):O(b.tab,"ui-state-default ui-state-highlight","ui-state-active");this.activate();t(b.tabCount,0)},maximize:function(){this.isMaximize()||(this._setVisibile(),this._changeState("maximize"))},restore:function(){Q(this.element,"webim-window-normal")||(this._setVisibile(),this._changeState("restore"))},minimize:function(){this.isMinimize()||(y(this.$.tab),O(this.$.tab,"ui-state-active","ui-state-default"),this.deactivate(),this._changeState("minimize"))},tabClose:function(){this.close()},close:function(){this.trigger("close");fa(this.element)},detach:function(){var b=this.position,a=this.$.window,n=this.$.detach;this.isDetached()||(m(this.$.tab),a.style.bottom=b.bottom+"px",a.style.right=b.right+"px",O(n.firstChild,"ui-icon-arrowthick-1-ne","ui-icon-arrowthick-1-sw"),this.detached=!0)},isDetached:function(){return this.detached||!1},attach:function(){var b=this.position,a=this.$.window,n=this.$.detach;y(this.$.tab);b.right=0;b.bottom=0;a.style.bottom="26.4px";a.style.right="0px";O(n.firstChild,"ui-icon-arrowthick-1-sw","ui-icon-arrowthick-1-ne");this.detached=!1},_beforeMove:function(b){var a=this.position,n=this.$.window;n.style.right&&(a.right=parseInt(n.style.right));n.style.bottom&&(a.bottom=parseInt(n.style.bottom));a.right=a.right||0;a.bottom=a.bottom||0;a.mouseX=b.pageX||b.clientX;a.mouseY=b.pageY||b.clientY},move:function(b){var a=this.position,n=this.$.window,c=(b.pageX||b.clientX)-a.mouseX,d=(b.pageY||b.clientY)-a.mouseY;a.mouseX=b.pageX||b.clientX;a.mouseY=b.pageY||b.clientY;a.right-=c;a.bottom-=d;n.style.right=a.right+"px";n.style.bottom=a.bottom+"px"},_initEvents:function(){var b=this,a=b.$,n=a.tab,c=a.header,d=function(b){ga(b);G(b)};if(b.options.detachable){k(a.detach,"click",function(a){b.isDetached()?b.attach():b.detach();d(a)});var e=function(a){b.move(a)};k(c,"mouseover",function(){b.isDetached()?c.style.cursor="move":c.style.cursor="default"});k(c,"mousedown",function(a){b.isDetached()&&(b._beforeMove(a),k(c,"mousemove",e))});k(c,"mouseup",function(b){if(c.addEventListener)c.removeEventListener("mousemove",e,!1);else if(c.detachEvent)try{c.detachEvent("onmousemove",c["mousemove"+e]),c["mousemove"+e]=null}catch(ya){}})}k(n,"click",function(a){b.isMinimize()?b.restore():b.minimize();d(a)});k(n,"mouseover",function(){x(this,"ui-state-hover");F(this,"ui-state-default")});k(n,"mouseout",function(){F(this,"ui-state-hover");-1==this.className.indexOf("ui-state-")&&x(this,"ui-state-default")});k(n,"mousedown",d);Y(n);D(ca(a.actions.firstChild),function(b,a){X(a,"ui-state-hover")});D(["minimize","maximize","close","tabClose"],function(l,n){k(a[n],"click",function(a){if(!this.disable)b[n]();d(a)});k(a[n],"mousedown",d)})},height:function(){return this.$.content.offsetHeight},_fitUI:function(b){},isMaximize:function(){return Q(this.element,"webim-window-maximize")},isMinimize:function(){return Q(this.element,"webim-window-minimize")}});var ua=function(){var b=!1,a=function(){b&&b.deactivate();b=!1;return!0},n=function(l){this&&this!=b&&a()&&(b=this)},c=function(a){this&&b==this&&(b=!1)};k(q,"mousedown",function(b){b=M(b);for(var l;b;)if(":webim-window"==b.id){l=b;break}else b=b.parentNode;l?(b=l.window)&&b.activate():a()});return function(l){l.active()&&(a(),b=l);l.bind("activate",n);l.bind("deactivate",c)}}();J("layout",function(b){function a(b){if(e)return m.updateAllChat();e=!0;b=k.get("tabs");var a=k.get("tabIds"),l=k.get("p"),c=k.get("a");a&&a.length&&b&&D(b,function(b,a){var l=b.slice(2),c=b.slice(0,1);m.addChat(c,l,{},{isMinimize:!0});m.chat(b).window.notifyUser("information",a.n)});l&&(m.prevCount=l)&&m._fitUI();c&&m.focusChat(c)}function n(){var b={};D(m.tabs,function(a,l){b[a]={n:l._count()}});k.set({tabs:b,tabIds:m.tabIds,p:m.prevCount,a:m.activeTabId})}b=b||{};var c=this.im,e=!1,f=c.buddy,g=c.history,k=c.status,p=c.setting,m=this.layout=new h.layout(null,L({chatAutoPop:c.setting.get("msg_auto_pop")},b,{ui:this}));c.setting.get("minimize_layout")?m.collapse():m.expand();c.bind("beforeOnline",function(){m.changeState("ready")}).bind("online",function(b,l){m.changeState("active");m.options.user=l.user;a(c)}).bind("offline",function(b,a,l){"offline"==a&&m.removeAllChat();m.updateAllChat();m.changeState("stop")});p.bind("update",function(b,a,l){"msg_auto_pop"==a?m.options.chatAutoPop=l:"minimize_layout"==a&&(l?m.collapse():m.expand())});f.bind("online",function(b,a){m.updateChat("buddy",a)}).bind("offline",function(b,a){m.updateChat("buddy",a)}).bind("update",function(b,a){m.updateChat("buddy",a)});m.bind("collapse",function(){p.set("minimize_layout",!0)});m.bind("expand",function(){p.set("minimize_layout",!1)});m.bind("displayUpdate",function(b){n()});c.bind("message",function(b,a){for(var l=!1,n=a.length,e,S=c.data.user.id,f,g,h=0;h<n;h++)e=a[h],f=e.id,type=e.type,(g=m.chat(type,f))&&g.status(""),g||("chat"===e.type?m.addChat(type,f,null,null,e.nick):m.addChat(type,f),g=m.chat(type,f)),g&&p.get("msg_auto_pop")&&!m.activeTabId&&m.focusChat(f),g.window.notifyUser("information","+1"),f=g.window.pos,-1==f&&m.setNextMsgNum("+1"),1==f&&m.setPrevMsgNum("+1"),e.from!=S&&(l=!0);l&&(ha.play("msg"),sa(d("new message"),5))});c.bind("status",function(b,a){D(a,function(b,a){var l=c.data.user.id,n=a.from;(l==a.to||l==a.from)&&(l=m.chat("buddy",n))&&l.status(a.show)})});(function(){g.bind("chat",function(b,a,l){if(b=m.chat("chat",a))b.history.add(l),b.pushRoom(l)});g.bind("clear",function(b,a,l){(b=m.chat(a,l))&&b.history.clear()})})();return m});A("layout",{template:'\x3cdiv id\x3d"webim" class\x3d"webim webim-state-ready"\x3e\r\n\t\t\x3cdiv class\x3d"webim-preload ui-helper-hidden-accessible"\x3e\r\n\t\t\x3cdiv id\x3d"webim-flashlib-c"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv id\x3d":layout" class\x3d"webim-layout"\x3e\x3c!--\x3ciframe class\x3d"webim-bgiframe" frameborder\x3d"0" tabindex\x3d"-1" src\x3d"about:blank;" \x3e\x3c/iframe\x3e--\x3e\x3cdiv class\x3d"webim-layout-bg ui-state-default ui-toolbar"\x3e\x3c/div\x3e\x3cdiv class\x3d"webim-ui ui-helper-clearfix"\x3e\r\n\t\t\x3cdiv id\x3d":shortcut" class\x3d"webim-shortcut"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"webim-layout-r"\x3e\r\n\t\t\x3cdiv id\x3d":panels" class\x3d"webim-panels"\x3e\r\n\t\t\x3cdiv class\x3d"webim-window-tab-wrap ui-widget webim-panels-next-wrap"\x3e\r\n\t\t\x3cdiv id\x3d":next" class\x3d"webim-window-tab webim-panels-next ui-state-default"\x3e\r\n\t\t\x3cdiv id\x3d":nextMsgCount" class\x3d"webim-window-tab-count"\x3e\r\n\t\t0\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cem class\x3d"ui-icon ui-icon-triangle-1-w"\x3e\x3c/em\x3e\r\n\t\t\x3cspan id\x3d":nextCount"\x3e0\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv id\x3d":tabsWrap" class\x3d"webim-panels-tab-wrap"\x3e\r\n\t\t\x3cdiv id\x3d":tabs" class\x3d"webim-panels-tab"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"webim-window-tab-wrap ui-widget webim-panels-prev-wrap"\x3e\r\n\t\t\x3cdiv id\x3d":prev" class\x3d"webim-window-tab webim-panels-prev ui-state-default"\x3e\r\n\t\t\x3cdiv id\x3d":prevMsgCount" class\x3d"webim-window-tab-count"\x3e\r\n\t\t0\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cspan id\x3d":prevCount"\x3e0\x3c/span\x3e\r\n\t\t\x3cem class\x3d"ui-icon ui-icon-triangle-1-e"\x3e\x3c/em\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"webim-window-tab-wrap webim-collapse-wrap ui-widget"\x3e\r\n\t\t\x3cdiv id\x3d":collapse" class\x3d"webim-window-tab webim-collapse ui-state-default" title\x3d"\x3c%\x3dcollapse%\x3e"\x3e\r\n\t\t\x3cem class\x3d"ui-icon ui-icon-circle-arrow-e"\x3e\x3c/em\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"webim-window-tab-wrap webim-expand-wrap ui-widget"\x3e\r\n\t\t\x3cdiv id\x3d":expand" class\x3d"webim-window-tab webim-expand ui-state-default" title\x3d"\x3c%\x3dexpand%\x3e"\x3e\r\n\t\t\x3cem class\x3d"ui-icon ui-icon-circle-arrow-w"\x3e\x3c/em\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv id\x3d":widgets" class\x3d"webim-widgets"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e',shortcutLength:5,chatAutoPop:!0,tpl_shortcut:'\x3cdiv class\x3d"webim-window-tab-wrap ui-widget webim-shortcut-item"\x3e\x3ca class\x3d"webim-window-tab" href\x3d"\x3c%\x3dlink%\x3e" target\x3d"\x3c%\x3dtarget%\x3e"\x3e\r\n\t\t\x3cdiv class\x3d"webim-window-tab-tip"\x3e\r\n\t\t\x3cstrong\x3e\x3c%\x3dtitle%\x3e\x3c/strong\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cem class\x3d"webim-icon" style\x3d"background-image:url(\x3c%\x3dicon%\x3e)"\x3e\x3c/em\x3e\r\n\t\t\x3c/a\x3e\r\n\t\t\x3c/div\x3e',chatApp:"chat"},{_init:function(b,a){a=this.options;L(this,{window:f,widgets:{},panels:{},tabWidth:136,maxVisibleTabs:null,animationTime:210,activeTabId:null,tabs:{},tabIds:[],nextCount:0,prevCount:0});a.unscalable&&x(this.$.layout,"webim-layout-unscalable");a.isMinimize&&this.collapse()},changeState:function(b){this.element.className="webim webim-state-"+b},_ready:!1,buildUI:function(b){b=this.$;this.maxVisibleTabs=parseInt((("CSS1Compat"===q.compatMode&&q.documentElement.clientWidth||q.body.clientWidth)-45-b.shortcut.offsetWidth-b.widgets.offsetWidth-70-105)/this.tabWidth);this._fitUI();this.options.disableResize||this._autoResizeWindow();this._ready=!0},_autoResizeWindow:function(){var b=this.$.widgets.offsetWidth,a;for(a in this.widgets){var c=this.widgets[a]&&this.widgets[a].window;if(c=c&&c.$&&c.$.window)c.style.width=b+"px"}},_updatePrevCount:function(b){var a=this.tabIds,c=this.maxVisibleTabs,d=a.length,e=this.prevCount;if(!(d<=c)){if(b){for(var f=0,g=0;g<d;g++)if(a[g]==b){f=g;break}f<=e?e=f:f>=e+c&&(e=f-c+1)}else e=d-c;this.prevCount=e}},_setVisibleTabs:function(b){for(var a=this.prevCount,c=a+this.maxVisibleTabs,d=this.tabs,e=this.tabIds,f=e.length,g=0,h=0,k=0;k<f;k++){var p=d[e[k]];if(k<a||k>=c)if(b)y(p.element);else{this.activeTabId==e[k]&&p.minimize();var q=p._count();k<a?(h+=q,p.pos=1):(g+=q,p.pos=-1);m(p.element)}else p.pos=0,y(p.element)}b||(this.setNextMsgNum(g),this.setPrevMsgNum(h))},setNextMsgNum:function(b){t(this.$.nextMsgCount,b)},setPrevMsgNum:function(b){t(this.$.prevMsgCount,b)},slideing:!1,_slide:function(b){var a=this,c=a.prevCount,d=a.nextCount;if(0<d&&-1==b||0<c&&1==b){a.slideing=!0;if(1==d&&-1==b||1==c&&1==b)a.slideing=!1;a._slideSetup(!1);a._setVisibleTabs(!0);-1==b?(a.nextCount--,a.prevCount++):1==b&&(a.nextCount++,a.prevCount--);var e=a.$.tabs,f=parseFloat(e.style.left),c=-1*a.tabWidth*a.nextCount,g=parseInt(500/13),h=1,k=(c-f)/g,m=setInterval(function(){e.style.left=f+k*h+"px";h==g?(a.slideing?a._slide(b):(a._fitUI(),a._slideReset()),clearInterval(m)):h++},13)}},_slideUp:function(){this.slideing=!1},_slideSetup:function(b){var a=this.$,c=a.tabsWrap,a=a.tabs;this._tabsWidth||(this._tabsWidth=a.clientWidth);b&&(this._tabsWidth=null);c.style.position=b?"":"relative";c.style.overflow=b?"visible":"hidden";c.style.width=b?"":this._tabsWidth+"px";a.style.width=b?"":this.tabWidth*this.tabIds.length+"px";a.style.position=b?"":"relative"},_slideReset:function(){this._slideSetup(!0)},_updateCount:function(){var b=this.maxVisibleTabs,a=this.tabIds.length,c=this.prevCount,d;a<=b?c=d=0:(d=a-b-c,d=0>d?0:d,c=a-b-d);this.prevCount=c;this.nextCount=d},_updateCountUI:function(){var b=this.$,a=this.prevCount,c=this.nextCount;0>=c?x(b.next,"ui-state-disabled"):F(b.next,"ui-state-disabled");0>=a?x(b.prev,"ui-state-disabled"):F(b.prev,"ui-state-disabled");0<a||0<c?(b.next.style.display="block",b.prev.style.display="block"):(m(b.next),m(b.prev));b.nextCount.innerHTML=c.toString();b.prevCount.innerHTML=a.toString()},_initEvents:function(){var b=this,a=b.$,c=!1;k(b.window,"resize",function(){c&&(c=!0,b.buildUI())});k(a.next,"mousedown",function(){b._slide(-1)});k(a.next,"mouseup",function(){b._slideUp()});Y(a.next);k(a.prev,"mousedown",function(){b._slide(1)});k(a.prev,"mouseup",function(){b._slideUp()});Y(a.prev);k(a.expand,"click",function(){if(!b.isMinimize())return!1;b.expand();b.trigger("expand");return!1});k(a.collapse,"click",function(){if(b.isMinimize())return!1;b.collapse();b.trigger("collapse");return!1});X(a.collapse,"ui-state-hover","ui-state-default");X(a.expand,"ui-state-hover","ui-state-default")},isMinimize:function(){return Q(this.$.layout,"webim-layout-minimize")},collapse:function(){this.isMinimize()||x(this.$.layout,"webim-layout-minimize")},expand:function(){this.isMinimize()&&F(this.$.layout,"webim-layout-minimize")},_displayUpdate:function(b){this._ready&&this.trigger("displayUpdate")},_fitUI:function(){this._updateCount();this.$.tabs.style.left=-1*this.tabWidth*this.nextCount+"px";this._updateCountUI();this._setVisibleTabs();this._displayUpdate()},_stickyWin:null,_widgetStateChange:function(b,a){"minimize"!=a&&D(this.widgets,function(a,c){c.window!=b&&c.window.minimize()});this._displayUpdate()},widget:function(b){return this.widgets[b]},addWidget:function(b,a,c,d){var l=this;a=L(a,{closeable:!1,subHeader:b.header});var n=b.element;a=new h.window(null,a);a.html(n);l.$[d?d:"widgets"].insertBefore(a.element,c&&l.widgets[c]?l.widgets[c].window.element:null);b.window=a;a.bind("displayStateChange",function(b,a){l._widgetStateChange(this,a)});l.widgets[b.name]=b},focusChat:function(b,a){a=r(b,a);var c=this.tabs[a],l=this.panels[a];c&&c.isMinimize()&&c.restore();l&&l.focus()},chat:function(b,a){return this.panels[r(b,a)]},updateChat:function(b,a){a=ja(a);for(var c,l=a.length,d,e=0;e<l;e++)c=a[e],(d=this.panels[r(b,c.id)])&&d.update(c)},updateAllChat:function(){D(this.panels,function(b,a){a.update()})},_onChatClose:function(b){this.tabIds=Z(this.tabIds,function(a,c){return a!=b});delete this.tabs[b];delete this.panels[b];this._changeActive(b,!0);this._fitUI()},_onChatChange:function(b,a){"minimize"==a?(this._changeActive(b,!0),this._displayUpdate()):(this._changeActive(b),this._fitUI())},_changeActive:function(b,a){var c=this.activeTabId;if(a)c==b&&(this.activeTabId=null);else{var l=this.tabs[c];c&&c!=b&&!l.isDetached()&&l.minimize();this.activeTabId=b;this._updatePrevCount(b)}},addChat:function(b,a,c,d,e){b="buddy";var l=this;if(!l.chat(b,a)){var n=l.panels,f=r(b,a);d=l.tabs[f]=(new h.window(null,L({isMinimize:l.activeTabId||!l.options.chatAutoPop,tabWidth:l.tabWidth-2,detachable:l.options.detachable||!1,titleVisibleLength:9},d))).bind("close",function(){l._onChatClose(f)}).bind("displayStateChange",function(b,a){l._onChatChange(f,a)});b=l.options.ui.addApp(l.options.chatApp,L({id:a,type:b,nick:e,window:d},c));n[f]=b;l.tabIds.push(f);l.$.tabs.insertBefore(d.element,l.$.tabs.firstChild);!d.isMinimize()&&l._changeActive(f);l._fitUI()}},removeChat:function(b,a){var c=this.tabs[r(b,a)];c&&c.close()},removeAllChat:function(){D(this.tabs,function(b,a){a.close()})},addShortcut:function(b){var a=this;if(H(b))D(b,function(b,c){a.addShortcut(c)});else if(B(b)){var c=a.$.shortcut,e=a.options.tpl_shortcut;c.childNodes.length>a.options.shortcutLength+1||(e=C(p(e,{title:d(b.title),icon:b.icon,link:b.link,target:b.isExtlink?"_blank":""})),X(e.firstChild,"ui-state-hover"),c.appendChild(e))}}});A("history",{user:{},info:{},template:'\x3cdiv class\x3d"webim-history"\x3e\r\n\t\t\t\t\t\t\t\x3cdiv id\x3d":content" class\x3d"webim-history-content"\x3e \r\n\t\t\t\t\t\x3c/div\x3e\x3c/div\x3e'},{_init:function(){z.call(this,"init",[null,this.ui()])},clear:function(){this.$.content.innerHTML="";this.trigger("clear")},add:function(b){b=ja(b);var a=this,c=b.length,d=[];if(c){for(var e=0;e<c;e++)d.push(a._renderMsg(b[e]));b=C("\x3cdiv\x3e"+d.join("")+"\x3c/div\x3e");d=b.getElementsByTagName("img");e=0;for(c=d.length;e<c;e++)k(d[e],"load",function(){a.trigger("update")});a.$.content.appendChild(b);a.trigger("update")}},notice:function(b,a){this.$.content.appendChild(C('\x3cdiv class\x3d"webim-history-notice ui-state-default ui-state-'+b+'"\x3e'+a+"\x3c/div\x3e"));this.trigger("update")},_renderMsg:function(b){b=L({},b);z.call(this,"render",[null,this.ui({msg:b})]);var a=b.from,c=b.to,d=b.timestamp,e=b.body,f=!0,g=this._lastLogItem,h=[],k;k=b.nick;g&&g.to==c&&g.from==a&&6E4>d-g.timestamp&&(f=!1);f&&(this._lastLogItem=b,a=new E(d),h.push('\x3ch4\x3e\x3cspan class\x3d"webim-gray"\x3e'),h.push(a.getDay(!0)),h.push(" "),h.push(a.getTime()),h.push("\x3c/span\x3e"),h.push(k),h.push('\x3c/h4\x3e\x3chr class\x3d"webim-line ui-state-default" /\x3e'));b.style?h.push('\x3cp style\x3d"'+b.style+'"\x3e'):h.push("\x3cp\x3e");h.push(e);h.push("\x3c/p\x3e");return h.join("")},_renderDateBreak:function(b){var a=this._lastLogItem,c=new Date,d=new Date,e=[];c.setTime(b);a&&d.setTime(a.timestamp);a&&c.getDate()==d.getDate()&&c.getMonth()==d.getMonth()||(e.push("\x3ch5\x3e"),e.push((new E(b)).getDay(!0)),e.push("\x3c/h5\x3e"));return e.join("")},ui:function(b){return L({element:this.element,$:this.$},b)},plugins:{}});var la=function(){return function(b,a){b=b.replace(/(http:\/\/www.muniao.com\/room\/([0-9]+).html)/ig,'\x3ca href\x3d"$1" class\x3d"webim_link" target\x3d"_blank"\x3e$1\x3c/a\x3e');b=b.replace(/(http:\/\/m.muniao.com\/h5room\/([0-9]+).html)/ig,'\x3ca href\x3d"$1" class\x3d"webim_link" target\x3d"_blank"\x3e$1\x3c/a\x3e');console.log("line 4226",b);b=b.replace(/\[roomid=([0-9]+)\&nbsp\;image\=http:\/\/assets.muniao.com\/([0-9a-zA-Z\/\.\_]+)\&nbsp\;priceday\=(.*)\&nbsp\;privacy\=(.*)\&nbsp\;propertytype\=(.*)\&nbsp\;accommodates\=(.*)\](.+)\[\/roomid\]/ig,'\x3ca href\x3d"http://www.muniao.com/room/$1.html" class\x3d"webim_link" target\x3d"_blank"\x3e$7\x3c/a\x3e');b=b.replace(/\[roomid=([0-9]+)\&nbsp\;image\=http:\/\/assets.muniao.com\/([0-9a-zA-Z\/\.\_]+)\](.+)\[\/roomid\]/ig,'\x3ca href\x3d"http://www.muniao.com/room/$1.html" class\x3d"webim_link" target\x3d"_blank"\x3e$3\x3c/a\x3e');return b.replace(/\[roomid=([0-9]+)\]([^\[]+)\[\/roomid\]/ig,'\x3ca href\x3d"http://www.muniao.com/room/$1.html" class\x3d"webim_link" target\x3d"_blank"\x3e$2\x3c/a\x3e')}}();h.history.defaults.parseMsg=!0;z.add("history","parseMsg",{render:function(b,a){var c=a.msg.body,c=W(c),c=la(c,{target:"_blank"});a.msg.body=c}});h.history.defaults.emot=!0;z.add("history","emot",{render:function(b,a){a.msg.body=h.emot.parse(a.msg.body)}});A("emot",{template:'\x3cdiv class\x3d"webim-emot ui-widget-content"\x3e\x3c%\x3demots%\x3e\x3c/div\x3e'},{_init:function(b){var a=this,c=a.element;D(c.firstChild.childNodes,function(b,l){k(l,"click",function(b){F(c,"webim-emot-show");a.trigger("select",this.firstChild.getAttribute("rel"))})})},template:function(){var b=this.emots=webim.ui.emot.emots,a=[];a.push('\x3cul class\x3d"ui-helper-clearfix"\x3e');D(b,function(b,c){var l=c.src,d=c.t?c.t:c.q[0];a.push('\x3cli\x3e\x3cimg src\x3d"');a.push(l.replace("http://assets.muniao.com/","//assets.muniao.com/"));a.push('" title\x3d"');a.push(d);a.push('" alt\x3d"');a.push(c.q[0]);a.push('" rel\x3d"');a.push(c.q[0]);a.push('" height\x3d"'+c.hei+'" width\x3d"'+c.wid+'" /\x3e\x3c/li\x3e')});a.push("\x3c/ul\x3e");return p(this.options.template,{emots:a.join("")})},toggle:function(){P(this.element,"webim-emot-show")}});L(h.emot,{emots:[{t:"\u597d\u7684",src:"ok",q:["[\u597d\u7684]"],hei:48,wid:48},{t:"\u9f13\u638c",src:"applause",q:["[\u9f13\u638c]"],hei:48,wid:48},{t:"\u62a0\u9f3b",src:"picknose",q:["[\u62a0\u9f3b]"],hei:48,wid:48},{t:"\u4eb2\u4eb2",src:"kiss",q:["[\u4eb2\u4eb2]"],hei:48,wid:48},{t:"\u5fae\u7b11",src:"smile",q:["[\u5fae\u7b11]"],hei:48,wid:48},{t:"\u63e1\u624b",src:"shakehands",q:["[\u63e1\u624b]"],hei:48,wid:48},{t:"\u7591\u95ee",src:"question",q:["[\u7591\u95ee]"],hei:48,wid:48},{t:"\u62e5\u62b1",src:"hug",q:["[\u62e5\u62b1]"],hei:48,wid:48},{t:"\u518d\u89c1",src:"goodbye",q:["[\u518d\u89c1]"],hei:48,wid:48},{t:"\u8d5e",src:"thumbup",q:["[\u8d5e]"],hei:48,wid:48}],init:function(b){var a=webim.ui.emot,c=a._q={};b=L({dir:"webim/static/emot/default",ext:"png"},b);b.emots&&(a.emots=b.emots);var d=b.dir+"/",e=b.ext;D(a.emots,function(b,a){a&&a.src&&(a.src=d+a.src+"."+e);a&&a.q&&D(a.q,function(a,l){c[l]=b})})},parse:function(a){var b=webim.ui.emot._q,c=webim.ui.emot.emots;b&&D(b,function(b,l){var d=c[l],e=d.src,n=d.t?d.t:d.q[0],f=[];f.push('\x3cimg src\x3d"');f.push(e);f.push('" title\x3d"');f.push(n);f.push('" alt\x3d"');f.push(d.q[0]);f.push('" height\x3d"'+d.hei+'" width\x3d"'+d.wid+'" /\x3e');b=W(b);b=b.replace(RegExp("(\\.|\\$|\\^|\\*|\\\\|\\[|\\]|\\(|\\)|\\||\\+|\\?|\\{|\\}|\\:|\\\x3c|\\\x3e)","g"),"\\$1");a=a.replace(new RegExp(b,"g"),f.join(""))});return a}});A("upload",{template:'\x3cdiv class\x3d"webim-upload ui-widget-content"\x3e\x3cform class\x3d"ui-helper-clearfix" id\x3d":form" method\x3d"POST" enctype\x3d"multipart/form-data" encoding\x3d"multipart/form-data"\x3e\x3cinput id\x3d":input" type\x3d"file" name\x3d"files" /\x3e\x3cinput id\x3d":submit" class\x3d"ui-state-default ui-corner-all webim-upload-submit" type\x3d"submit" value\x3d"\x3c%\x3dupload%\x3e" /\x3e\x3c/form\x3e\x3c/div\x3e'},{_init:function(a){var b=this;b.$.form.setAttribute("action",ra("upload"));c(b.$.form,function(a){b.$.submit.disabled=!1;if(a=a&&a[0])if(!a.url||a.error)alert(a.error||"Upload error");else{for(var c="",d=["image/jpeg","image/jpg","image/gif","image/png"],l=0;l<d.length;l++)if(d[l]==a.type){c="!";break}c+="["+(a.name||"").replace(/\[|\]/ig,"")+"]("+a.url+")";a.thumbnailUrl&&(c+="("+a.thumbnailUrl+")");try{b.$.form.reset(),b.$.input.value=""}catch(wa){}b.toggle();b.trigger("upload",c)}else alert("Upload error")},function(){b.$.submit.disabled=!0})},toggle:function(){P(this.element,"webim-upload-show")}});J("chat",function(a){a=a||{};var b=this.im,c=b.history,d=a.id;if("room"!=a.type){var e=c.get("chat",d);e||c.load("chat",d);var f=b.buddy.get(d)||{id:d,nick:a.nick||d};a=L({emot:!0,clearHistory:!0},this.options.buddyChatOptions,{info:f,user:b.data.user,history:e,block:!1,member:!1,msgType:"chat"},a);var g=new h.chat(null,a);b.buddy.get(d)||b.buddy.update(d);g.bind("sendMessage",function(a,d){b.sendMessage(d,function(a){a&&a.message&&g.history.notice("error",a.message)});c.set(d)}).bind("sendStatus",function(a,c){b.sendStatus(c)}).bind("clearHistory",function(a,b){c.clear("chat",b.id)})}return g});A("chat",{tpl_header:'\x3cdiv\x3e\x3cdiv id\x3d":user" class\x3d"webim-user"\x3e \r\n\t\t\x3ca id\x3d":userPic" class\x3d"webim-user-pic ui-corner-all ui-state-active sssssssss" href\x3d"#"\x3e\x3cimg width\x3d"50" height\x3d"50" src\x3d"" defaultsrc\x3d"" onerror\x3d"var d\x3dthis.getAttribute(\'defaultsrc\');if(d \x26\x26 this.src!\x3dd)this.src\x3dd;" class\x3d"ui-corner-all"\x3e\x3c/a\x3e \r\n\t\t\x3cspan id\x3d":userStatus" title\x3d"" class\x3d"webim-user-status"\x3e\x26nbsp;\x3c/span\x3e \r\n\t\t\x3c/div\x3e\x3c/div\x3e',template:'\x3cdiv id\x3d":container" class\x3d"webim-chat webim-box webim-flex"\x3e \r\n\t\t\x3cdiv class\x3d"webim-chat-notice-wrap1"\x3e\x3cdiv class\x3d"webim-chat-notice-wrap"\x3e\x3cdiv id\x3d":notice" class\x3d"webim-chat-notice ui-state-highlight"\x3e\x3c/div\x3e\x3c/div\x3e \x3c/div\x3e\r\n\t\t\x3cdiv id\x3d":content" class\x3d"webim-chat-content webim-flex webim-box-h"\x3e \r\n\t\t\x3cdiv id\x3d":sidebar" class\x3d"webim-chat-sidebar webim-box"\x3e\x3c/div\x3e\x3cdiv class\x3d"webim-flex webim-box"\x3e\x3cdiv id\x3d":main" class\x3d"webim-chat-main webim-flex"\x3e\x3cdiv id\x3d":status" class\x3d"webim-chat-status webim-gray"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e \r\n\t\t\x3c/div\x3e \r\n\t\t\x3cdiv id\x3d":actions" class\x3d"webim-chat-actions"\x3e \r\n\t\t\x3cdiv id\x3d":toolContent" class\x3d"webim-chat-tool-content"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv id\x3d":tools" class\x3d"webim-chat-tools ui-helper-clearfix ui-state-default"\x3e\x3c/div\x3e\r\n\t\t\x3ctable class\x3d"webim-chat-t" cellSpacing\x3d"0"\x3e \r\n\t\t\x3ctr\x3e \r\n\t\t\x3ctd style\x3d"vertical-align:top;width:100%;"\x3e \r\n\t\t\x3cdiv class\x3d"webim-chat-input-wrap"\x3e\r\n\t\t\x3ctextarea id\x3d":input" class\x3d"webim-chat-input webim-gray ui-widget-content"\x3e\x3c%\x3dinput notice%\x3e\x3c/textarea\x3e \r\n\t\t\x3c/div\x3e \r\n\t\t\x3c/td\x3e \r\n\t\t\x3c/tr\x3e \r\n\t\t\x3c/table\x3e \r\n\t\t\x3c/div\x3e \r\n\t\t\x3c/div\x3e'},{_init:function(){var a=this,c=a.element,d=a.options,e=d.window,f=a.history=new h.history(null,{user:d.user,info:d.info});x(c,"webim-chat-"+d.type);a.$.main.insertBefore(f.element,a.$.main.firstChild);a.header=C(p(d.tpl_header));L(a.$,w(a.header));a._initEvents();e&&a.setWindow(e);d.simple&&m(a.header);a.update(d.info);a.pushRoom(d.history);f.add(d.history);z.call(a,"init",[null,a.ui()]);setTimeout(function(){a._adjustContent()},0)},pushRoom:function(a){if(a&&"length"in a){for(var b=0;b<a.length;b++){var c=a[b],d=/\[roomid=([0-9]+)\ image\=http:\/\/assets.muniao.com\/([0-9a-zA-Z\/\.\_]+)\](.+)\[\/roomid\]/ig,e=/\[roomid=([0-9]+)\ image\=http:\/\/assets.muniao.com\/([0-9a-zA-Z\/\.\_]+)\ priceday\=(.*)\ privacy\=(.*)\ propertytype\=(.*)\ accommodates\=(.*)\](.+)\[\/roomid\]/ig;e.test(c.body)?(console.log("re2",c.body,e),c=c.body.replace(e,'\x3cdiv id\x3d"" style\x3d"display: block;" style\x3d"overflow: hidden;"\x3e\x3ca href\x3d"http://www.muniao.com/room/$1.html" title\x3d"$7" target\x3d"_blank"\x3e\x3cimg src\x3d"//assets.muniao.com/$2" style\x3d"float: left;margin-right: 10px;" width\x3d"55" height\x3d"55"\x3e\x3c/a\x3e\x3cdiv style\x3d"float: left;width: 170px;word-break : break-all;word-wrap : break-word ;overflow:auto;"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.muniao.com/room/$1.html" title\x3d"$7"\x3e$7\x3c/a\x3e\x3cbr\x3e$4-$5-$6\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d"clear:both;"\x3e\x3c/div\x3e'),this.notice(c,999999)):d.test(c.body)&&(console.log("re",c.body,d),c=c.body.replace(d,'\x3cdiv id\x3d"" style\x3d"display: block;" style\x3d"overflow: hidden;"\x3e\x3ca href\x3d"http://www.muniao.com/room/$1.html" title\x3d"$3" target\x3d"_blank"\x3e\x3cimg src\x3d"//assets.muniao.com/$2" style\x3d"float: left;margin-right: 10px;" width\x3d"55" height\x3d"55"\x3e\x3c/a\x3e\x3cdiv style\x3d"float: left;width: 170px;word-break : break-all;word-wrap : break-word ;overflow:auto;"\x3e\u5f53\u524d\u623f\u6e90\uff1a\x3cbr\x3e\x3ca target\x3d"_blank" href\x3d"http://www.muniao.com/room/$1.html" title\x3d"$3"\x3e$3\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d"clear:both;"\x3e\x3c/div\x3e'),this.notice(c,999999))}return a}},setWindow:function(a,c){this.window=a;a.subHeader(this.header);!c&&a.html(this.element);a.title(this.options.info.nick);this._bindWindow()},update:function(a){a&&(this.options.info=a,this.history.options.info=a,this._updateInfo(a));z.call(this,"update",[null,this.ui()])},focus:function(){var a=this.$.input;f.setTimeout(function(){try{a.focus()}catch(l){}},0)},_noticeTime:null,_noticeTxt:"",notice:function(a,c){var b=this,d=b.$.notice,l=b._noticeTime;l&&clearTimeout(l);a?c?(d.innerHTML=a,y(d),setTimeout(function(){b._noticeTxt?d.innerHTML=b._noticeTxt:m(d,500)},c)):(b._noticeTxt=a,d.innerHTML=a,y(d)):(b._noticeTxt=null,m(d))},_adjustContent:function(){var a=this.$.main;a.scrollTop!=a.scrollHeight&&(a.scrollTop=a.scrollHeight)},_fitUI:function(a){this._adjustContent()},_bindWindow:function(){var a=this;a.window.bind("displayStateChange",function(b,c){"minimize"!=c&&(f.setTimeout(function(){a.$.input.focus()},0),a._adjustContent())}).bind("close",function(){a.destroy()})},_inputAutoHeight:function(){var a=this.$.input,c=a[0].scrollTop;if(0<c){var d=a.height();32<d&&100>d&&a.height(d+c)}},sendMessage:function(a){var b=this.options,c=b.info;a={type:"chat",to:c.id,from:b.user.id,nick:b.user.nick,to_nick:c.nick,stype:"",offline:"online"!=c.presence?"true":"false",timestamp:(new Date).getTime()-E.timeSkew,body:a,unique_value:guid.newGUID()};z.call(this,"send",[null,this.ui({msg:a})]);this.trigger("sendMessage",[a])},_inputkeypress:function(a){if(13==a.keyCode){if(a.ctrlKey)return this.insert("\n",!0),!0;var b=M(a),c=b.value;g(c).length&&(this.sendMessage(c),b.value="",G(a))}else this._typing()},_onFocusInput:function(a){var b=this;M(a);(f.getSelection?f.getSelection().toString():q.selection&&q.selection.createRange().text)||f.setTimeout(function(){b.$.input.focus()},0)},_initEvents:function(){var a=this,c=a.$,e=d("input notice"),f=c.input;a.history.bind("update",function(){a._adjustContent()}).bind("clear",function(){a.notice(d("clear history notice"),3E3)});k(f,"keyup",function(){oa.call(this)});k(f,"click",oa);k(f,"select",oa);k(f,"focus",function(){F(this,"webim-gray");this.value==e&&(this.value="")});k(f,"blur",function(){""==this.value&&(x(this,"webim-gray"),this.value=e)});k(f,"keypress",function(b){a._inputkeypress(b)});k(c.main,"click",function(b){a._onFocusInput(b)})},_updateInfo:function(a){var b=this.$;b.userPic.setAttribute("href",a.url||"javascript:void(0);");b.userPic.setAttribute("target",a.target||this.options.target||"");b.userPic.firstChild.setAttribute("defaultsrc",a.default_avatar?a.default_avatar:"");setTimeout(function(){if(a.avatar||a.default_avatar)try{b.userPic.firstChild.setAttribute("src",a.avatar||a.default_avatar)}catch(n){}},100);b.userStatus.innerHTML=ba(a.status)||"\x26nbsp";this.window&&this.window.title(a.nick,a.show)},insert:function(a,c){var b=this.$.input;b.focus();b.value==d("input notice")&&(b.value="");if(c)if(a||(a=""),b.setSelectionRange){var l=b.value,e=b.selectionStart,f=b.selectionEnd,g=l.substring(0,e),l=l.substring(f),f=a.length;b.value=g+a+l;b.setSelectionRange(e+f,e+f)}else q.selection?(e=b.caretPos)?(e.text=a,e.collapse(),e.select()):b.value+=a:b.value+=a;else b.value=a},_statusText:"",sendStatus:function(a){a&&a!=this._statusText&&"offline"!=this.options.info.presence&&(this._statusText=a,this.trigger("sendStatus",[{to:this.options.info.id,show:a}]))},_checkST:!1,_typing:function(){var a=this;a.sendStatus("typing");a._checkST&&clearTimeout(a._checkST);a._checkST=f.setTimeout(function(){a.sendStatus("clear")},6E3)},_setST:null,status:function(a){a=a||"clear";var b=this.$.status,c=this.options.info.nick,e="",e="clear"==a?"":c+d(a);b.innerHTML=e;this._adjustContent();this._setST&&clearTimeout(this._setST);""!=e&&(this._setST=f.setTimeout(function(){b.innerHTML=""},1E4))},destroy:function(){this.trigger("destroy")},ui:function(a){return L({self:this,$:this.$,history:this.history},a)},plugins:{}});h.chat.defaults.emot=!0;z.add("chat","emot",{init:function(a,c){var b=c.self,d=b.emot=new h.emot;d.bind("select",function(a,c){b.sendMessage(c)});var e=C(p('\x3ca href\x3d"#chat-emot" title\x3d"\x3c%\x3demot%\x3e"\x3e\x3cem class\x3d"webim-icon webim-icon-emot"\x3e\x3c/em\x3e\x3c/a\x3e'));k(e,"click",function(a){b.upload&&F(b.upload.element,"webim-upload-show");G(a);d.toggle()});c.$.toolContent.appendChild(d.element);c.$.tools.appendChild(e)},send:function(a,c){}});h.chat.defaults.upload=!1;z.add("chat","upload",{init:function(a,c){var b=c.self,d=b.upload=new h.upload;d.bind("upload",function(a,c){b.sendMessage(c)});var e=C(p('\x3ca href\x3d"#chat-upload" title\x3d"\x3c%\x3dupload%\x3e"\x3e\x3cem class\x3d"webim-icon webim-icon-upload"\x3e\x3c/em\x3e\x3c/a\x3e'));k(e,"click",function(a){b.emot&&F(b.emot.element,"webim-emot-show");G(a);d.toggle()});c.$.toolContent.appendChild(d.element);c.$.tools.appendChild(e)},send:function(a,c){}});h.chat.defaults.clearHistory=!0;z.add("chat","clearHistory",{init:function(a,c){var b=c.self,d=C(p('\x3ca href\x3d"#chat-clearHistory" title\x3d"\x3c%\x3dclear history%\x3e"\x3e\x3cem class\x3d"webim-icon webim-icon-clear"\x3e\x3c/em\x3e\x3c/a\x3e'));k(d,"click",function(a){G(a);b.trigger("clearHistory",[b.options.info])});c.$.tools.appendChild(d)}});h.chat.defaults.block=!0;z.add("chat","block",{init:function(a,c){var b=c.self,e=b.options.info.blocked,l=b.options.info.nick,f=C('\x3ca href\x3d"#chat-block" style\x3d"display:'+(e?"none":"")+'" title\x3d"'+d("block group",{name:l})+'"\x3e\x3cem class\x3d"webim-icon webim-icon-unblock"\x3e\x3c/em\x3e\x3c/a\x3e'),g=C('\x3ca href\x3d"#chat-block" style\x3d"display:'+(e?"":"none")+'" title\x3d"'+d("unblock group",{name:l})+'"\x3e\x3cem class\x3d"webim-icon webim-icon-block"\x3e\x3c/em\x3e\x3c/a\x3e');k(f,"click",function(a){G(a);m(f);y(g);b.trigger("block",[b.options.info])});k(g,"click",function(a){G(a);m(g);y(f);b.trigger("unblock",[b.options.info])});c.$.tools.appendChild(f);c.$.tools.appendChild(g)}});h.chat.defaults.member=!0;z.add("chat","member",{init:function(a,c){var b=c.$;c.self.memberLi={};var d=C(p('\x3cdiv class\x3d"webim-box webim-flex webim-member ui-widget-content ui-corner-left"\x3e\x3ciframe id\x3d":bgiframe" class\x3d"webim-bgiframe" frameborder\x3d"0" tabindex\x3d"-1" src\x3d"about:blank;" \x3e\x3c/iframe\x3e\x3ch4\x3e\x3c%\x3droom member%\x3e:\x3cspan id\x3d":memberCount"\x3e0\x3c/span\x3e\x3c/h4\x3e\x3cul id\x3d":ul" class\x3d"webim-flex"\x3e\x3c/ul\x3e\x3c/div\x3e')),e=w(d);b.member=e.ul;b.memberCount=e.memberCount;b.sidebar.appendChild(d)}});J("setting",function(a){var b=this.im.setting,c=this.layout,e=this.setting=new h.setting(null,a);c.addWidget(e,{title:d("setting"),icon:"setting",sticky:!1,onlyIcon:!0,isMinimize:!0});b.bind("update",function(a,b,c){"object"!=typeof c&&e.check_tag(b,c)});e.bind("change",function(a,c,d){b.set(c,d)})});A("setting",{template:'\x3cdiv id\x3d"webim-setting" class\x3d"webim-setting"\x3e\r\n\t\t\t\t\x3cul id\x3d":ul"\x3e\x3c%\x3dtags%\x3e\x3c/ul\x3e\r\n\t\t\t\x3c/div\x3e',tpl_check:'\x3cli id\x3d":\x3c%\x3dname%\x3e"\x3e\x3cinput type\x3d"checkbox" \x3c%\x3dchecked%\x3e id\x3d"webim-setting-\x3c%\x3dname%\x3e" name\x3d"\x3c%\x3dname%\x3e"/\x3e\x3clabel for\x3d"webim-setting-\x3c%\x3dname%\x3e"\x3e\x3c%\x3dlabel%\x3e\x3c/label\x3e\x3c/li\x3e'},{_init:function(){var a=this.options.copyright;a&&this.element.appendChild(C(!0===a?'\x3cp style\x3d"margin: 5px 10px;"\x3e\x3c/p\x3e':a))},template:function(){var a=this,c=[],d=a.options.data;d&&D(d,function(b,d){d&&"boolean"!=typeof d||c.push(a._check_tpl(b,d))});return p(a.options.template,{tags:c.join("")})},_initEvents:function(){var a=this,c=a.options.data,d=a.$;c&&D(c,function(b,c){d[b]&&a._check_event(d[b])})},_check_tpl:function(a,c){return p(this.options.tpl_check,{label:d(a),name:a,checked:c?'checked\x3d"checked"':""})},_check_event:function(a){var b=this;k(a.firstChild,"click",function(a){b._change(this.name,this.checked)})},check_tag:function(a,c){var b=this;if(B(a))D(a,function(a,c){b.check_tag(a,c)});else{var d=b.$,e=d[a];c&&"boolean"!=typeof c||(e?e.firstChild.checked=c:(e=d[a]=C(b._check_tpl(a,c)),b._check_event(e),d.ul.appendChild(e)))}},_change:function(a,c){this.trigger("change",[a,c])},destroy:function(){}});J("presence",function(a){I("line 5321 ",this.im)});J("user",function(a){a=a||{};var b=this.im,c=new h.user;!a.show&&m(c.element);a.container&&a.container.appendChild(c.element);c.bind("online",function(a,c){b.online(c)}).bind("offline",function(){b.offline()}).bind("presence",function(a,c){b.sendPresence(c)});c.update(b.data.user);b.bind("online",function(){y(c.element);c.update(b.data.user)}).bind("offline",function(a,b){c.show("unavailable")});return c});A("user",{template:'\x3cdiv\x3e \r\n\t\t\t\x3cdiv id\x3d":user" class\x3d"webim-user"\x3e \r\n\t\t\t\t\x3ca id\x3d":userPic" class\x3d"webim-user-pic ui-corner-all ui-state-active" href\x3d"#id"\x3e\x3cimg width\x3d"50" height\x3d"50" defaultsrc\x3d"" onerror\x3d"var d\x3dthis.getAttribute(\'defaultsrc\');if(d \x26\x26 this.src!\x3dd)this.src\x3dd;" class\x3d"ui-corner-all"\x3e\x3c/a\x3e \r\n\t\t\t\t\t\x3cdiv class\x3d"webim-user-show"\x3e\x3ch4\x3e\x3ca id\x3d":userShowTrigger" href\x3d"#show"\x3e\x3cstrong id\x3d":userNick"\x3e\x3c/strong\x3e\x3cspan id\x3d":userShow"\x3e\x3cem class\x3d"webim-icon webim-icon-unavailable"\x3e\x3c%\x3dunavailable%\x3e\x3c/em\x3e\x3c%\x3dunavailable%\x3e\x3c/span\x3e\x3cem class\x3d"ui-icon ui-icon-triangle-1-s"\x3e\x3c%\x3dshow_status_list%\x3e\x3c/em\x3e\x3c/a\x3e\x3c/h4\x3e\r\n\t\t\t\t\t\t\x3cp id\x3d":userShowList" class\x3d"ui-state-active ui-corner-all" style\x3d"display: none;"\x3e\r\n\t\t\t\t\t\t\t\x3ca href\x3d"#available" class\x3d"webim-user-show-available"\x3e\x3cem class\x3d"webim-icon webim-icon-available"\x3e\x3c%\x3davailable%\x3e\x3c/em\x3e\x3c%\x3davailable%\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\t\x3ca href\x3d"#dnd" class\x3d"webim-user-show-dnd"\x3e\x3cem class\x3d"webim-icon webim-icon-dnd"\x3e\x3c%\x3ddnd%\x3e\x3c/em\x3e\x3c%\x3ddnd%\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\t\x3ca href\x3d"#away" class\x3d"webim-user-show-away"\x3e\x3cem class\x3d"webim-icon webim-icon-away"\x3e\x3c%\x3daway%\x3e\x3c/em\x3e\x3c%\x3daway%\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\t\x3ca href\x3d"#invisible" class\x3d"webim-user-show-invisible"\x3e\x3cem class\x3d"webim-icon webim-icon-invisible"\x3e\x3c%\x3dinvisible%\x3e\x3c/em\x3e\x3c%\x3dinvisible%\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\t\x3ca href\x3d"#unavailable" class\x3d"webim-user-show-unavailable"\x3e\x3cem class\x3d"webim-icon webim-icon-unavailable"\x3e\x3c%\x3dunavailable%\x3e\x3c/em\x3e\x3c%\x3dunavailable%\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\x3c/p\x3e\r\n\t\t\t\t\t\x3c/div\x3e \r\n\t\t\t\t\t\t\x3cspan id\x3d":userStatus" title\x3d"" class\x3d"webim-user-status"\x3e\x3c/span\x3e \r\n\t\t\t\t\t\t\t\x3c/div\x3e \r\n\t\t\t\t\t\t\t\t\x3c/div\x3e'},{_init:function(){},_initEvents:function(){var a=this,c=a.$,d=c.userShowList;k(c.userShowTrigger,"click",function(a){"block"==d.style.display?m(d):y(d);G(a)});D(ca(d.firstChild),function(b,c){k(c,"click",function(b){a._set(this.href.split("#")[1]);m(d);G(b)})})},update:function(a){var b=a.show||"unavailable",c=this.$;this.options.info=a;c.userStatus.innerHTML=ba(a.status)||"\x26nbsp;";c.userNick.innerHTML=a.nick||"";c.userPic.setAttribute("href",a.url);c.userPic.firstChild.setAttribute("defaultsrc",a.default_avatar?a.default_avatar:"");setTimeout(function(){(a.avatar||a.default_avatar)&&c.userPic.firstChild.setAttribute("src",a.avatar||a.default_avatar)},100);this.show(b)},show:function(a){var b=d(a);this.$.userShow.innerHTML='\x3cem class\x3d"webim-icon webim-icon-'+a+'"\x3e'+b+"\x3c/em\x3e"+b},_set:function(a){var b=this.options.info;this.show(a);b?b.show!=a&&("unavailable"==a?this.trigger("offline",[]):"unavailable"==b.show?this.trigger("online",[{show:a}]):this.trigger("presence",[{show:a,status:b.status}])):"unavailable"!=a&&this.trigger("online",[{show:a}])},destroy:function(){}});J("login",function(a){a=a||{};var b=this.im,c=new h.login(null,a);a.container&&a.container.appendChild(c.element);c.bind("login",function(a,c){b.online(c)});b.bind("online",function(){c.hide()}).bind("offline",function(a,b,d){"online"==b&&c.showError(d)});return c});A("login",{questions:null,notice:"",template:'\x3cdiv id\x3d":login" class\x3d"webim-login"\x3e \r\n\t\t\t\t\x3cdiv class\x3d"webim-login-logo" id\x3d":logo"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"webim-login-notice" id\x3d":notice"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"ui-state-error webim-login-error ui-corner-all" style\x3d"display: none;" id\x3d":error"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cform id\x3d":form"\x3e\r\n\t\t\t\t\t\x3cp class\x3d"ui-helper-clearfix"\x3e\x3clabel for\x3d":username"\x3e\x3c%\x3dusername%\x3e\x3c/label\x3e\x3cinput name\x3d"username" id\x3d":username" type\x3d"text" /\x3e\x3c/p\x3e\r\n\t\t\t\t\t\x3cp class\x3d"ui-helper-clearfix"\x3e\x3clabel for\x3d":password"\x3e\x3c%\x3dpassword%\x3e\x3c/label\x3e\x3cinput name\x3d"password" id\x3d":password" type\x3d"password" /\x3e\x3c/p\x3e\r\n\t\t\t\t\t\x3cdiv id\x3d":more"\x3e\r\n\t\t\t\t\t\x3cp class\x3d"ui-helper-clearfix"\x3e\x3clabel for\x3d":question"\x3e\x3c%\x3dquestion%\x3e\x3c/label\x3e\x3cselect name\x3d"question" id\x3d":question" \x3e\x3c/select\x3e\x3c/p\x3e\r\n\t\t\t\t\t\x3cp class\x3d"ui-helper-clearfix"\x3e\x3clabel for\x3d":answer"\x3e\x3c%\x3danswer%\x3e\x3c/label\x3e\x3cinput name\x3d"answer" id\x3d":answer" type\x3d"text" /\x3e\x3c/p\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3cp class\x3d"ui-helper-clearfix"\x3e\x3cinput name\x3d"submit" id\x3d":submit" class\x3d"ui-state-default ui-corner-all webim-login-submit" value\x3d"\x3c%\x3dlogin%\x3e" type\x3d"submit" /\x3e\x3c/p\x3e\r\n\t\t\t\t\x3c/form\x3e\r\n\t\t\t\x3c/div\x3e'},{_init:function(){var a=this.options.questions,c=this.$;a&&a.length?D(a,function(a,b){var d=q.createElement("option");d.value=b[0];d.innerHTML=b[1];c.question.appendChild(d)}):m(c.more);c.notice.innerHTML=this.options.notice},_initEvents:function(){var a=this,c=a.$;X(c.submit,"ui-state-hover");k(c.form,"submit",function(b){G(b);a.trigger("login",[{username:c.username.value,password:c.password.value,question:c.question.value,answer:c.answer.value}])})},hide:function(){m(this.element)},show:function(){y(this.element)},hideError:function(){m(this.$.error)},showError:function(a){var b=this.$.error;b.innerHTML=d(a);y(b)},destroy:function(){}});J("buddy",function(a){a=a||{};var b=this,c=b.im,e=c.buddy,g=b.layout,k=new h.buddy(null,L({title:a.title||d("buddy")},a));g.addWidget(k,{className:"webim-buddy-window",title:a.title||d("buddy"),titleVisibleLength:19,sticky:c.setting.get("buddy_sticky"),isMinimize:!c.status.get("b"),icon:"buddy"});k.bind("select",function(a,c){b.layout.addChat("buddy",c.id);b.layout.focusChat("buddy",c.id)}).bind("remove",function(a,b){f.confirm(d("Remove Buddy",{name:b.nick}))&&e.remove(b.id)});var m;a.disable_user||(m=b.addApp("user",a.userOptions),a.is_login&&(k.window.subHeader(m.element),y(m.element),m=null));a.is_login||a.disable_login||b.addApp("login",L({container:k.$.content},a.loginOptions));c.setting.bind("update",function(a,b){"buddy_sticky"==a&&(k.window.option.sticky=b)});k.window&&k.window.bind("displayStateChange",function(a,b){"minimize"!=b?(e.options.active=!0,c.status.set("b",1),e.complete()):(c.status.set("b",0),e.options.active=!1)});var p=function(a){return B(a)?a.id:a},q=function(a){return"invisible"!=a.show&&"online"==a.presence},r=function(a){return"invisible"==a.show};e.bind("online",function(b,c){a.showUnavailable?(k.remove(ka(c,p)),k.add(c)):k.add(Z(c,q))});e.bind("offline",function(b,c){a.showUnavailable?(k.remove(ka(c,p)),k.add(c)):k.remove(ka(c,p))});e.bind("update",function(b,c){a.showUnavailable?(k.add(c),k.update(c)):(k.add(Z(c,q)),k.update(Z(c,q)),k.remove(ka(Z(c,r),p)))});e.bind("unsubscribe",function(a,c){var d=ka(c,p);D(d,function(a,c){b.layout.removeChat("buddy",c)});k.remove(d)});k.offline();c.bind("beforeOnline",function(){k.online()}).bind("online",function(){m&&k.window.subHeader(m.element);k.titleCount()}).bind("offline",function(a,b){k.offline()});return k});A("buddy",{template:'\x3cdiv id\x3d"webim-buddy" class\x3d"webim-buddy webim-flex webim-box"\x3e\r\n\t\t\t\x3cdiv id\x3d":search" class\x3d"webim-buddy-search ui-state-default ui-corner-all"\x3e\x3cem class\x3d"ui-icon ui-icon-search"\x3e\x3c/em\x3e\x3cinput id\x3d":searchInput" type\x3d"text" value\x3d"" /\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"webim-buddy-content webim-flex" id\x3d":content"\x3e\r\n\t\t\t\t\t\x3cdiv id\x3d":empty" class\x3d"webim-buddy-empty"\x3e\x3c%\x3dempty buddy%\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cul id\x3d":ul"\x3e\x3c/ul\x3e\r\n\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/div\x3e',tpl_group:'\x3cli\x3e\x3ch4\x3e\x3cem class\x3d"ui-icon ui-icon-triangle-1-s"\x3e\x3c/em\x3e\x3cspan\x3e\x3c%\x3dtitle%\x3e(\x3c%\x3dcount%\x3e)\x3c/span\x3e\x3c/h4\x3e\x3chr class\x3d"webim-line ui-state-default" /\x3e\x3cul\x3e\x3c/ul\x3e\x3c/li\x3e',tpl_li:'\x3cli title\x3d"" class\x3d"webim-buddy-\x3c%\x3dshow%\x3e"\x3e\x3ca href\x3d"#\x3c%\x3durl%\x3e" rel\x3d"\x3c%\x3did%\x3e" class\x3d"ui-helper-clearfix"\x3e\x3cdiv id\x3d":tabCount" class\x3d"webim-window-tab-count"\x3e0\x3c/div\x3e\x3cem class\x3d"webim-icon ui-icon ui-icon-trash" style\x3d"display:none;cursor:pointer;"\x3e\x3c/em\x3e\x3cem class\x3d"webim-icon webim-icon-\x3c%\x3dshow%\x3e" title\x3d"\x3c%\x3dhuman_show%\x3e"\x3e\x3c%\x3dshow%\x3e\x3c/em\x3e\x3cimg width\x3d"25" src\x3d"\x3c%\x3davatar%\x3e" defaultsrc\x3d"\x3c%\x3ddefault_avatar%\x3e" onerror\x3d"var d\x3dthis.getAttribute(\'defaultsrc\');if(d \x26\x26 this.src!\x3dd)this.src\x3dd;" /\x3e\x3cstrong\x3e\x3c%\x3dnick%\x3e\x3c/strong\x3e\x3cspan\x3e\x3c%\x3dstatus%\x3e\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e'},{_init:function(){var a=this.options;this.groups={};this.li={};this.li_group={};this.on_li={};this.on_li_group={};this.size=0;this.presences={};a.disable_group&&x(this.element,"webim-buddy-hidegroup");a.simple&&x(this.element,"webim-buddy-simple")},_initEvents:function(){var a=this,c=a.$,e=c.search,f=c.searchInput,g=d("search buddy");k(e.firstChild,"click",function(){f.focus()});f.value=g;k(f,"focus",function(){x(e,"ui-state-active");this.value==g&&(this.value="")});k(f,"blur",function(){F(e,"ui-state-active");""==this.value&&(this.value=g)});k(f,"keyup",function(){var b=this.value;b==N||""==b?(D(a.groups,function(a,b){y(b.el)}),D(a.on_li,function(a,b){y(b)}),D(a.li,function(a,b){y(b)})):(D(a.groups,function(a,b){m(b.el)}),D(a.on_li,function(a,b){m(b)}),D(a.li,function(a,b){m(b)}),D(a.li,function(c,d){if(0<=(d.text||d.innerHTML.replace(/<[^>]*>/g,"")).indexOf(b)){var e=a.li_group[c];e&&y(e.el);y(d)}}))})},titleCount:function(){var a=this.size,c=this.window,d=this.$.empty,e=0;D(this.presences,function(a,b){b.o&&e++});c&&c.title(this.options.title+"["+e+"/"+(a?a:"0")+"]");a?m(d):y(d);8<a?this.scroll(!0):this.scroll(!1)},groupTitleCount:function(a){var b=0;a.name==d("online_group")?a.title.innerHTML=a.name+"["+a.count+"]":(D(this.presences,function(c,d){d.o&&d.g==a.name&&b++}),a.title.innerHTML=a.name+"["+b+"/"+a.count+"]")},scroll:function(a){P(this.element,"webim-buddy-scroll",a)},_time:null,_titleBuddyOnline:function(a){var b=this;a||(a="");b._time&&clearTimeout(b._time);b._time=setTimeout(function(){b.titleCount()},5E3)},_title:function(a){var b=this.window;b&&b.title(this.options.title+"["+d(a)+"]")},notice:function(a,c){switch(a){case "buddyOnline":this._titleBuddyOnline(c);break;default:this._title(a)}},online:function(){var a=this.$;this.notice("connect");m(a.empty)},offline:function(){var a=this.$;this.scroll(!1);this.removeAll();this.presences={};m(a.empty);this.notice("offline")},_updateInfo:function(a,c){var b=c.show?c.show:"available";a.className="webim-buddy-"+b;a=a.firstChild;a.setAttribute("href",c.url);a=a.firstChild;a=a.nextSibling;a=a.nextSibling;a.className="webim-icon webim-icon-"+b;a.setAttribute("title",d(b));a=a.nextSibling;a.setAttribute("defaultsrc",c.default_avatar?c.default_avatar:"");(c.avatar||c.default_avatar)&&a.setAttribute("src",c.avatar||c.default_avatar);a=a.nextSibling;a.innerHTML=c.nick;a=a.nextSibling;a.innerHTML=ba(c.status)||"\x26nbsp;";return a},showCount:function(a,c){var b=this.li;b[a]&&t(b[a].firstChild.firstChild,c)},isOnline:function(a){return!("unavailable"==a||"invisible"==a)},_addOne:function(a,c){var b=this.li,d=this.on_li,e=this.li_group,f=this.on_li_group;a.show=a.show||"available";this.options.online_group&&this.isOnline(a.show)&&this._addOne2Grp(a,d,"online_group",f,!1);this._addOne2Grp(a,b,a.group||"friend",e,c)},_addOne2Grp:function(a,c,e,f,g){var b=this,l=a.id,h=b.$.ul;if(!c[l]){c===b.li&&(b.presences[a.id]={o:b.isOnline(a.show),g:d(e)},b.size++);a.default_avatar||(a.default_avatar="");a.status=ba(a.status)||"\x26nbsp;";a.human_show=d(a.show);a.avatar=a.avatar||"";c=c[l]=C(p(b.options.tpl_li,a));var n=c.firstChild;k(n.firstChild.nextSibling,"click",function(c){b.trigger("remove",[a]);ga(c);G(c)});k(n,"click",function(c){G(c);b.showCount(l,0);b.trigger("select",[a]);this.blur()});n=b.groups;e=d(e);n=n[e];if(!n){n=C(p(b.options.tpl_group));m(n);e==d("stranger")&&(g=!0);e==d("online_group")?h.insertBefore(n,h.firstChild):g?(h.appendChild(n),b._lastChild=n):b._lastChild?h.insertBefore(n,h.lastChild):h.appendChild(n);var q=n.lastChild;g=n.firstChild;var r=g.firstChild,h=b.options.collapse,n={name:e,el:n,count:0,online_count:0,title:n.firstChild.lastChild,li:q};b.groups[e]=n;h===N?m(r):(h&&(O(r,"ui-icon-triangle-1-s","ui-icon-triangle-1-e"),m(q)),k(g,"click",function(){Q(r,"ui-icon-triangle-1-s")?(O(r,"ui-icon-triangle-1-s","ui-icon-triangle-1-e"),m(q)):(O(r,"ui-icon-triangle-1-e","ui-icon-triangle-1-s"),y(q))}))}0==n.count&&y(n.el);f[l]=n;b.isOnline(a.show)?n.li.insertBefore(c,n.li.firstChild):n.li.appendChild(c);n.count++;b.groupTitleCount(n)}},_updateOne:function(a){var b=this.li,c=this.on_li,e=a.id;b[e]&&this._updateInfo(b[e],a);c[e]&&this._updateInfo(c[e],a);b=a.show||"available";c=d(a.group||"friend");this.presences[a.id]={o:this.isOnline(b),g:c};(a=this.groups[c])&&this.groupTitleCount(a)},update:function(a){a=ja(a);for(var b=0;b<a.length;b++)this._updateOne(a[b]);this.titleCount()},add:function(a,c){a=ja(a);for(var b=0;b<a.length;b++)this._addOne(a[b],c);this.titleCount()},removeAll:function(){var a=[],c=this.li,d;for(d in c)a.push(d);this.remove(a)},remove:function(a){var b;a=U(a);for(var c=0;c<a.length;c++)b=a[c],this._removeOne(b,this.on_li,this.on_li_group),this._removeOne(b,this.li,this.li_group);this.titleCount()},_removeOne:function(a,c,d){var b=c[a];if(b){c==this.li&&(this.size--,delete this.presences[a]);if(group=d[a])group.count--,0==group.count&&m(group.el),this.groupTitleCount(group);fa(b);delete c[a]}},select:function(a){(a=this.li[a])&&a.firstChild.click();return a},active:function(a){if(this.options.highlightable)if(this._actived&&F(this._actived.firstChild,"ui-state-default ui-state-highlight"),a){if(a=this.li[a])x(a.firstChild,"ui-state-default ui-state-highlight"),this._actived=a}else this._actived=null},destroy:function(){}});J("menu",function(a){var b=this.layout;a=this.menu=new h.menu(null,a);b.addWidget(a,{title:d("menu"),icon:"home",sticky:!1,onlyIcon:!1,isMinimize:!0},null,"shortcut")});A("menu",{template:'\x3cdiv id\x3d"webim-menu" class\x3d"webim-menu"\x3e\r\n\t\t\t\x3cul id\x3d":ul"\x3e\x3c%\x3dlist%\x3e\x3c/ul\x3e\r\n\t\t\t\t\x3cdiv id\x3d":empty" class\x3d"webim-menu-empty"\x3e\x3c%\x3dempty menu%\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/div\x3e',tpl_li:'\x3cli\x3e\x3ca href\x3d"\x3c%\x3dlink%\x3e" target\x3d"\x3c%\x3dtarget%\x3e"\x3e\x3cimg src\x3d"\x3c%\x3dicon%\x3e"/\x3e\x3cspan\x3e\x3c%\x3dtitle%\x3e\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e'},{_init:function(){var a=this.options;a.data&&a.data.length&&m(this.$.empty)},template:function(){var a=this,c=[],d=a.options.data;d&&D(d,function(b,d){c.push(a._li_tpl(d))});return p(a.options.template,{list:c.join("")})},_li_tpl:function(a){return p(this.options.tpl_li,{title:d(a.title),icon:a.icon,link:a.link,target:a.isExtlink?"_blank":""})},_fitUI:function(){var a=this.element;300<a.clientHeight&&(a.style.height="300px")},add:function(a){var b=this;if(H(a))D(a,function(a,c){b.add(c)});else{var c=b.$;m(c.empty);c.ul.appendChild(C(b._li_tpl(a)))}},destroy:function(){}});J("chatbtn",function(a){var b=this,c=b.im,d=b.chatbtn=(new webim.ui.chatbtn(null,a)).bind("select",function(a,c){var d=q.getElementById(c);b.im.online();c=c.substr(13);b.layout.addChat("buddy",c);b.layout.focusChat("buddy",c);console.log("line 5828",d);if(d&&d.getAttributeNode("data-title")&&d.getAttributeNode("data-image")){var e=d.getAttributeNode("data-id").value,f=d.getAttributeNode("data-image").value,g=d.getAttributeNode("data-title").value,h=d.getAttributeNode("data-privacy").value,l="";try{l=d.getAttributeNode("data-propertytype").value}catch(za){l=""}var k=d.getAttributeNode("data-accommodates").value,m=d.getAttributeNode("data-priceday").value,n=b.layout.chat("buddy",c);n&&setTimeout(function(){h&&l&&k&&m?n.sendMessage("[roomid\x3d"+e+" image\x3d"+f+" priceday\x3d"+m+" privacy\x3d"+h+" propertytype\x3d"+l+" accommodates\x3d"+k+"]"+g+"[/roomid]"):n.sendMessage("[roomid\x3d"+e+" image\x3d"+f+"]"+g+"[/roomid]")},500)}}),e=function(a){return"invisible"!=a.show&&"unavailable"!=a.show},f=function(a){return"invisible"==a.show};c.models.presence.bind("online",function(a,b){d.on(b)}).bind("update",function(a,b){d.on(Z(b,e));d.off(Z(b,f))}).bind("offline",function(a,b){d.off(b)});c.bind("beforeOnline",function(a,b){b.chatlink_ids=d.idsArray()}).bind("online",function(a){d.off(c.data.user)}).bind("offline",function(a){d.offAll()})});A("chatbtn",{wrap:null,re_id:[/\#chat\@([^\/]+)/i],elementId:null,className:/webim-chatbtn/,autoInsertlink:!0},{_init:function(){function a(a,b){if(!a||!b)return!1;for(var c=b.length,d=0;d<c;d++){var e=b[d].exec(a);if(e&&e[1])return e[1]}return!1}var c=this,e=c.list={},f=c.options,g=c.anthors={},h=f.re_id,m=f.elementId,p=f.className,f=f.wrap||q;f=m?(f=q.getElementById(m))?[f]:null:f.getElementsByTagName("a");f&&D(f,function(b,f){var l=a(f.href,h),n=f.innerHTML;l&&n&&(m||p.test(f.className))&&(g[l]?g[l].push(f):g[l]=[f],e[l]={id:l,name:n},0==ca(f.firstChild).length&&(n=C('\x3ci class\x3d"webim-chaticon"\x3e\x3cem\x3e\x26nbsp;'),f.appendChild(n),f.icon=n),f.title=d("offline1"),f.href="javascript:void(0)",f.id="webim-chatid-"+l,String(_IMC.user.id)!=l&&k(f,"click",function(a){c.trigger("select",this.id);ga(a);G(a)}))})},idsArray:function(){var a=[];D(this.list,function(b,c){a.push(b)});return a},on:function(a){var b=this.list,c=this.anthors,e=a.length,f,g,h;for(f=0;f<e;f++)if(g=a[f],g.id&&(h=g.uid||g.id)&&b[h]&&(g=c[h]))for(var k=0;k<g.length;k++){var m=g[k];m&&m.icon&&x(m.icon,"webim-chaticon-online");m&&(m.title=d("online"))}},off:function(a){var b=this.list,c=this.anthors,e=a.length,f,g,h;for(f=0;f<e;f++)if(g=a[f],g.id&&(h=g.uid||g.id)&&b[h]&&(g=c[h]))for(var k=0;k<g.length;k++){var m=g[k];m&&m.icon&&F(m.icon,"webim-chaticon-online");m&&(m.title=d("unavailable"))}},offAll:function(){D(this.anthors,function(a,c){c&&D(c,function(a,b){b&&b.icon&&F(b.icon,"webim-chaticon-online");b&&(b.title=d("unavailable"))})})}});qa("notification",{url:"webim/notifications"},{_init:function(){},grep:function(a,c){return a&&a.text},handle:function(a){a=Z(ja(a),this.grep);a.length&&this.trigger("data",[a])},load:function(){}});J("notification",function(a){var b=this.im,c=this.layout,e=this.notification=new h.notification(null,a),f=b.notification=new webim.notification(null,{jsonp:b.options.jsonp});c.addWidget(e,{title:d("notification"),icon:"notification",sticky:!1,onlyIcon:!0,isMinimize:!0});f.bind("data",function(a,b){e.window.notifyUser("information","+"+b.length);e.add(b)});setTimeout(function(){f.load()},2E3)});A("notification",{template:'\x3cdiv id\x3d"webim-notification" class\x3d"webim-notification"\x3e\r\n\t\t\x3cul id\x3d":ul"\x3e\x3c%\x3dlist%\x3e\x3c/ul\x3e\r\n\t\t\x3cdiv id\x3d":empty" class\x3d"webim-notification-empty"\x3e\x3c%\x3dempty notification%\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e',tpl_li:'\x3cli\x3e\x3ca href\x3d"\x3c%\x3dlink%\x3e" target\x3d"\x3c%\x3dtarget%\x3e"\x3e\x3c%\x3dtext%\x3e\x3c/a\x3e\x3c/li\x3e'},{_init:function(){var a=this.options;a.data&&a.data.length&&m(this.$.empty)},template:function(){var a=this,c=[],d=a.options.data;d&&D(d,function(b,d){c.push(a._li_tpl(d))});return p(a.options.template,{list:c.join("")})},_li_tpl:function(a){return p(this.options.tpl_li,{text:a.text,link:a.link,target:this.options.target||a.target||""})},_fitUI:function(){var a=this.element;300<a.clientHeight&&(a.style.height="300px")},add:function(a){var b=this;if(H(a))D(a,function(a,c){b.add(c)});else{var c=b.$;m(c.empty);c.ul.appendChild(C(b._li_tpl(a)))}},destroy:function(){}})})(window,document);